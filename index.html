<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Flashcards Bolognia - Myriam ZERROUDI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      background: #f5f5f5;
    }

    /* ======================
       √âCRAN DE CODE / VERROU
       ====================== */
    .lock-screen {
      position: fixed;
      inset: 0;
      background: #0f172a;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      z-index: 1000;
    }

    .lock-card {
      background: white;
      border-radius: 16px;
      padding: 24px 20px;
      max-width: 360px;
      width: 100%;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    }

    .lock-card h1 {
      font-size: 1.4rem;
      margin-bottom: 4px;
      color: #111827;
    }

    .lock-card p {
      font-size: 0.9rem;
      margin: 4px 0 12px;
      color: #4b5563;
    }

    .lock-input {
      width: 100%;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      font-size: 0.95rem;
      margin-bottom: 10px;
      outline: none;
    }

    .lock-input:focus {
      border-color: #111827;
    }

    .lock-btn {
      width: 100%;
      padding: 8px 10px;
      border-radius: 999px;
      border: none;
      background: #111827;
      color: white;
      font-size: 0.95rem;
      cursor: pointer;
    }

    .lock-btn:hover {
      background: #020617;
    }

    .lock-error {
      margin-top: 8px;
      color: #b91c1c;
      font-size: 0.85rem;
    }

    /* ======================
       LAYOUT GLOBAL
       ====================== */
    .layout {
      display: flex;
      min-height: 100vh;
    }

    /* Colonne de gauche (cat√©gories) */
    .sidebar {
      width: 260px;
      background: #111827;
      color: #e5e7eb;
      padding: 16px 12px;
      display: flex;
      flex-direction: column;
      height: 100vh;           /* prend toute la hauteur de l'√©cran */
    }

    .sidebar h2 {
      font-size: 1rem;
      margin: 0 0 8px;
    }

    .category-list {
      margin-top: 8px;
      flex: 1;
      overflow-y: auto;        /* scroll interne */
      display: flex;
      flex-direction: column;
      gap: 6px;
      padding-right: 4px;
    }

    .category-item {
      text-align: left;
      padding: 6px 8px;
      border-radius: 8px;
      border: none;
      background: transparent;
      color: inherit;
      font-size: 0.85rem;
      cursor: pointer;
    }

    .category-item:hover {
      background: rgba(255, 255, 255, 0.12);
    }

    .category-item.active {
      background: #f9fafb;
      color: #111827;
      font-weight: 600;
    }

    /* Erreurs (rouge clair) */
    .category-item[data-category="Erreurs"] {
      background: #fee2e2;
      color: #991b1b;
    }

    .category-item[data-category="Erreurs"]:hover {
      background: #fecaca;
    }

    .category-item[data-category="Erreurs"].active {
      background: #fecaca;
      color: #7f1d1d;
    }

    /* Al√©atoire (rose pastel) */
    .category-item[data-category="Al√©atoire"] {
      background: #fce7f3;
      color: #9d174d;
    }

    .category-item[data-category="Al√©atoire"]:hover {
      background: #fbcfe8;
    }

    .category-item[data-category="Al√©atoire"].active {
      background: #fbcfe8;
      color: #831843;
      font-weight: 600;
    }

    /* Dermoscopie (vert clair) */
    .category-item[data-category="Dermoscopie"] {
      background: #dcfce7;
      color: #166534;
    }

    .category-item[data-category="Dermoscopie"]:hover {
      background: #bbf7d0;
    }

    .category-item[data-category="Dermoscopie"].active {
      background: #bbf7d0;
      color: #14532d;
      font-weight: 600;
    }

    /* ======================
       PARTIE DROITE
       ====================== */
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 16px;
      padding: 24px;
      align-items: center;
    }

    /* Bandeau titre + recherche */
    .top-bar {
      width: 100%;
      max-width: 900px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      flex-wrap: wrap;
    }

    .title {
      font-size: 1.8rem;
      font-weight: 600;
      margin: 0;
      color: #111827;
      display: flex;
      align-items: baseline;
      gap: 4px;
    }

    .subtitle-name {
      font-size: 0.9rem;
      font-weight: 400;
      opacity: 0.75;
    }

    .header-search {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: nowrap;
    }

    .header-search input {
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      font-size: 1rem;
      min-width: 240px;
      max-width: 320px;
      outline: none;
    }

    .header-search input::placeholder {
      color: #9ca3af;
    }

    .header-search button {
      padding: 8px 12px;
      border-radius: 999px;
      border: none;
      background: #111827;
      color: white;
      font-size: 0.9rem;
      cursor: pointer;
      white-space: nowrap;
    }

    .header-search button:hover {
      background: #020617;
    }

    /* ======================
       MODE R√âVISION
       ====================== */
    #reviewMode {
      width: 100%;
      max-width: 900px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: stretch;
    }

    .review-layout {
      display: flex;
      gap: 16px;
      align-items: stretch;
    }

    .review-left {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .qa-text {
      background: white;
      border-radius: 12px;
      padding: 12px 16px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
      font-size: 1.05rem;
      text-align: left;
      cursor: pointer; /* pour indiquer qu'on peut cliquer pour retourner */
    }

    .qa-text strong {
      font-weight: 600;
    }

    .card {
  position: relative;
  width: 100%;             /* laisse la carte prendre la largeur dispo */
  max-width: 700px;
  margin: 0 auto;
  background: white;
  border-radius: 16px;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;  /* contenu centr√© verticalement */
  padding: 20px;
  text-align: center;
  font-size: 1rem;
  cursor: pointer;
  user-select: none;
  transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease;
  /* ‚úÖ pas de height, pas de min-height, pas de overflow-y :
     la carte s‚Äôadapte √† la taille image + texte */
}

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
    }

    /* Image dans la carte (plus grande, cadre identique) */
    #card img {
  max-height: 28vh;
  max-width: 100%;
  width: 80%;
  height: auto;
  display: block;
  margin: 0 auto 12px;
  border-radius: 12px;
  object-fit: contain;
}

    .caption {
      margin-top: 8px;
      font-size: 0.9rem;
      color: #6b7280;
      text-align: left;
      max-width: 90%;
    }

    .controls-column {
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: stretch;
      justify-content: flex-start;
    }

    .controls-column button {
      width: 140px;
    }

    button {
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: #111827;
      color: white;
      font-size: 0.9rem;
    }

    button:disabled {
      opacity: 0.4;
      cursor: default;
    }

    .btn-know {
      background: #16a34a;
    }

    .btn-error {
      background: #dc2626;
    }

    .btn-error.active-error {
      box-shadow: 0 0 0 2px #fecaca;
    }

    .info {
      margin-top: 4px;
      font-size: 0.85rem;
      color: #6b7280;
      text-align: center;
    }

    /* ======================
       MODE RECHERCHE
       ====================== */
    .search-mode {
      width: 100%;
      max-width: 900px;
    }

    .search-mode-header {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      justify-content: space-between;
      margin-top: 12px;
      margin-bottom: 12px;
    }

    .search-mode-header h2 {
      font-size: 1.1rem;
      margin: 0;
    }

    .search-query-label {
      font-size: 0.9rem;
      color: #4b5563;
      margin: 0;
    }

    #exitSearchBtn {
      font-size: 0.8rem;
      padding: 6px 10px;
      border-radius: 999px;
      border: none;
      background: #111827;
      color: white;
      cursor: pointer;
      white-space: nowrap;
    }

    .search-results {
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: 60vh;
      overflow-y: auto;
      padding-right: 4px;
    }

    .search-card {
      background: white;
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
      text-align: left;
    }

    .search-card-header {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      margin-bottom: 6px;
      color: #6b7280;
    }

    .search-card-index {
      font-weight: 500;
    }

    .search-card-category {
      font-weight: 500;
    }

    .search-card img {
      width: 40%;
      max-width: 260px;
      height: auto;
      display: block;
      margin-bottom: 8px;
      border-radius: 8px;
    }

    .search-card-front,
    .search-card-back,
    .search-card-caption {
      font-size: 0.9rem;
      margin-bottom: 4px;
    }

    .search-card-jump {
      margin-top: 6px;
      font-size: 0.8rem;
      padding: 6px 10px;
      border-radius: 999px;
      border: none;
      background: #111827;
      color: white;
      cursor: pointer;
    }

    /* ======================
       RESPONSIVE
       ====================== */
    @media (max-width: 900px) {
      .review-layout {
        flex-direction: column;
      }

      .controls-column {
        flex-direction: row;
        justify-content: center;
        flex-wrap: wrap;
      }

      .controls-column button {
        width: auto;
      }
    }

    @media (max-width: 768px) {
      .layout {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        height: auto;
        max-height: 260px;
      }

      .category-item {
        font-size: 0.8rem;
        padding: 4px 6px;
      }

      .card {
        width: 100%;
        min-height: 50vh;
      }

      #card img {
        width: 80%;
      }

      .search-card img {
        width: 60%;
      }

      .top-bar {
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <!-- √âCRAN DE CODE -->
  <div id="lockScreen" class="lock-screen">
    <div class="lock-card">
      <h1>Flashcards Bolognia</h1>
      <p>Acc√®s r√©serv√© ‚Äì entre le code :</p>
      <input
        id="codeInput"
        type="password"
        class="lock-input"
        placeholder="Code d‚Äôacc√®s"
      >
      <button id="codeBtn" class="lock-btn">Valider</button>
      <p id="codeError" class="lock-error" style="display:none;">Code incorrect</p>
    </div>
  </div>

  <!-- APP PRINCIPALE -->
  <div id="app" style="display:none;">
    <div class="layout">
      <!-- Colonne gauche : cat√©gories -->
      <aside class="sidebar">
        <h2>Cat√©gories</h2>
        <div class="category-list">
          <button class="category-item" data-category="Erreurs">Erreurs</button>
          <button class="category-item active" data-category="Al√©atoire">Al√©atoire</button>
          <button class="category-item" data-category="Dermoscopie">Dermoscopie</button>

          <button class="category-item" data-category="Prurit et dysesth√©sies">Prurit et dysesth√©sies</button>
          <button class="category-item" data-category="Affections psychocutan√©es">Affections psychocutan√©es</button>
          <button class="category-item" data-category="Psoriasis">Psoriasis</button>
          <button class="category-item" data-category="Autres affections papulosquameuses">Autres affections papulosquameuses</button>
          <button class="category-item" data-category="Erythrodermie">Erythrodermie</button>
          <button class="category-item" data-category="Lichen plan et dermatoses lich√©no√Ødes">Lichen plan et dermatoses lich√©no√Ødes</button>
          <button class="category-item" data-category="Dermatite atopique">Dermatite atopique</button>
          <button class="category-item" data-category="Autres √©ruptions ecz√©mateuses">Autres √©ruptions ecz√©mateuses</button>
          <button class="category-item" data-category="Dermatites de contact / pro / aux plantes">Dermatites de contact / pro / aux plantes</button>
          <button class="category-item" data-category="Approche clinique des dermatoses r√©gionales">Approche clinique des dermatoses r√©gionales</button>
          <button class="category-item" data-category="Urticaire et angio-oed√®me">Urticaire et angio-oed√®me</button>
          <button class="category-item" data-category="Eryth√®mes figur√©s">Eryth√®mes figur√©s</button>
          <button class="category-item" data-category="Eryth√®me polymorphe, SJS et NET">Eryth√®me polymorphe, SJS et NET</button>
          <button class="category-item" data-category="R√©actions aux m√©dicaments">R√©actions aux m√©dicaments</button>
          <button class="category-item" data-category="Purpura et affections dues √† une occlusion microvasculaire">Purpura et affections dues √† une occlusion microvasculaire</button>
          <button class="category-item" data-category="Vascularites">Vascularites</button>
          <button class="category-item" data-category="Dermatoses √©osinophiliques">Dermatoses √©osinophiliques</button>
          <button class="category-item" data-category="Dermatoses neutrophiliques">Dermatoses neutrophiliques</button>
          <button class="category-item" data-category="Dermatoses de la grossesse">Dermatoses de la grossesse</button>
          <button class="category-item" data-category="Pemphigus">Pemphigus</button>
          <button class="category-item" data-category="Pemphigo√Øde et √©pidermolyse bulleuse acquise">Pemphigo√Øde et √©pidermolyse bulleuse acquise</button>

          <button class="category-item" data-category="Dermatite herp√©tiforme et dermatose bulleuse √† IgA lin√©aires">Dermatite herp√©tiforme et dermatose bulleuse √† IgA lin√©aires</button>
          <button class="category-item" data-category="√âpidermolyses bulleuses">√âpidermolyses bulleuses</button>
          <button class="category-item" data-category="Autres maladies v√©siculobulleuses">Autres maladies v√©siculobulleuses</button>
          <button class="category-item" data-category="Affections v√©siculopustuleuses et √©rosives chez les nouveau-n√©s et nourrissons">Affections v√©siculopustuleuses et √©rosives chez les nouveau-n√©s et nourrissons</button>

          <button class="category-item" data-category="Acn√© vulgaire">Acn√© vulgaire</button>
          <button class="category-item" data-category="Rosac√©e et dermatite p√©riorificielle">Rosac√©e et dermatite p√©riorificielle</button>
          <button class="category-item" data-category="Folliculites">Folliculites</button>
          <button class="category-item" data-category="Affections des glandes eccrines et apocrines">Affections des glandes eccrines et apocrines</button>

          <button class="category-item" data-category="Lupus √©ryth√©mateux">Lupus √©ryth√©mateux</button>
          <button class="category-item" data-category="Dermatomyosite">Dermatomyosite</button>
          <button class="category-item" data-category="Scl√©rodermie syst√©mique et affections scl√©rodermo√Ødes">Scl√©rodermie syst√©mique et affections scl√©rodermo√Ødes</button>
          <button class="category-item" data-category="Morph√©e et lichen scl√©reux">Morph√©e et lichen scl√©reux</button>
          <button class="category-item" data-category="Autres maladies rhumatologiques et maladies auto-inflammatoires">Autres maladies rhumatologiques et maladies auto-inflammatoires</button>

          <button class="category-item" data-category="Mucinoses">Mucinoses</button>
          <button class="category-item" data-category="Amylose">Amylose</button>
          <button class="category-item" data-category="Maladies de surcharge">Maladies de surcharge</button>
          <button class="category-item" data-category="Porphyries">Porphyries</button>
          <button class="category-item" data-category="Calcinose cutan√©e et ost√©ome cutan√©">Calcinose cutan√©e et ost√©ome cutan√©</button>
          <button class="category-item" data-category="D√©sordres nutritionnels">D√©sordres nutritionnels</button>
          <button class="category-item" data-category="Maladie du greffon contre l'h√¥te">Maladie du greffon contre l'h√¥te</button>
          <button class="category-item" data-category="Manifestations cutan√©es des maladies syst√©miques">Manifestations cutan√©es des maladies syst√©miques</button>

          <button class="category-item" data-category="Ichtyoses et √©rythrok√©ratodermies">Ichtyoses et √©rythrok√©ratodermies</button>
          <button class="category-item" data-category="K√©ratodermies">K√©ratodermies</button>
          <button class="category-item" data-category="Maladie de Darier et maladie de Hailey-Hailey">Maladie de Darier et maladie de Hailey-Hailey</button>

          <button class="category-item" data-category="D√©ficits immunitaires primitifs">D√©ficits immunitaires primitifs</button>
          <button class="category-item" data-category="Neurofibromatose et scl√©rose tub√©reuse de Bourneville">Neurofibromatose et scl√©rose tub√©reuse de Bourneville</button>
          <button class="category-item" data-category="Mosa√Øques cutan√©es">Mosa√Øques cutan√©es</button>
          <button class="category-item" data-category="Autres g√©nodermatoses">Autres g√©nodermatoses</button>
          <button class="category-item" data-category="Anomalies du d√©veloppement">Anomalies du d√©veloppement</button>

          <button class="category-item" data-category="Vitiligo et autres affections avec hypopigmentation">Vitiligo et autres affections avec hypopigmentation</button>
          <button class="category-item" data-category="Maladies avec hyperpigmentation">Maladies avec hyperpigmentation</button>
          <button class="category-item" data-category="Alop√©cies">Alop√©cies</button>
          <button class="category-item" data-category="Hypertrichose et hirsutisme">Hypertrichose et hirsutisme</button>
          <button class="category-item" data-category="Affections des ongles">Affections des ongles</button>
          <button class="category-item" data-category="Affections orales">Affections orales</button>
          <button class="category-item" data-category="Maladies anog√©nitales">Maladies anog√©nitales</button>

          <button class="category-item" data-category="Infections √† mycobact√©ries">Infections √† mycobact√©ries</button>
          <button class="category-item" data-category="Rickettsioses">Rickettsioses</button>
          <button class="category-item" data-category="Maladies fongiques">Maladies fongiques</button>
          <button class="category-item" data-category="Manifestations cutan√©es de l‚Äôinfection VIH">Manifestations cutan√©es de l‚Äôinfection VIH</button>
          <button class="category-item" data-category="Papillomavirus humains">Papillomavirus humains</button>
          <button class="category-item" data-category="Herp√®svirus humains">Herp√®svirus humains</button>
          <button class="category-item" data-category="Autres maladies virales">Autres maladies virales</button>
          <button class="category-item" data-category="Infections sexuellement transmissibles">Infections sexuellement transmissibles</button>
          <button class="category-item" data-category="Protozoaires et vers">Protozoaires et vers</button>
          <button class="category-item" data-category="Infestations">Infestations</button>
          <button class="category-item" data-category="Morsures et piq√ªres">Morsures et piq√ªres</button>

          <button class="category-item" data-category="Photodermatoses">Photodermatoses</button>
          <button class="category-item" data-category="Atteintes cutan√©es li√©es √† l'environnement et au sport">Atteintes cutan√©es li√©es √† l'environnement et au sport</button>
          <button class="category-item" data-category="Signes cutan√©s des toxicomanies, maltraitances">Signes cutan√©s des toxicomanies, maltraitances</button>

          <button class="category-item" data-category="Histiocytoses">Histiocytoses</button>
          <button class="category-item" data-category="Xanthomes">Xanthomes</button>
          <button class="category-item" data-category="Affections granulomateuses non infectieuses">Affections granulomateuses non infectieuses</button>
          <button class="category-item" data-category="Affections perforantes">Affections perforantes</button>
          <button class="category-item" data-category="Anomalies h√©r√©ditaires du tissu conjonctif">Anomalies h√©r√©ditaires du tissu conjonctif</button>
          <button class="category-item" data-category="Hypertrophies dermiques">Hypertrophies dermiques</button>
          <button class="category-item" data-category="Atrophies du tissu conjonctif">Atrophies du tissu conjonctif</button>
          <button class="category-item" data-category="Panniculites">Panniculites</button>
          <button class="category-item" data-category="Lipodystrophies">Lipodystrophies</button>

          <button class="category-item" data-category="H√©mangiomes infantiles et malformations vasculaires">H√©mangiomes infantiles et malformations vasculaires</button>
          <button class="category-item" data-category="Ulc√®res">Ulc√®res</button>
          <button class="category-item" data-category="Autres affections vasculaires">Autres affections vasculaires</button>

          <button class="category-item" data-category="K√©ratose actinique, CBC et CE">K√©ratose actinique, CBC et CE</button>
          <button class="category-item" data-category="Tumeurs et prolif√©rations √©pith√©liales b√©nignes">Tumeurs et prolif√©rations √©pith√©liales b√©nignes</button>
          <button class="category-item" data-category="Kystes">Kystes</button>
          <button class="category-item" data-category="Tumeurs annexielles">Tumeurs annexielles</button>
          <button class="category-item" data-category="N√©oplasmes m√©lanocytaires b√©nins">N√©oplasmes m√©lanocytaires b√©nins</button>
          <button class="category-item" data-category="M√©lanome cutan√©">M√©lanome cutan√©</button>
          <button class="category-item" data-category="Tumeurs vasculaires et prolif√©rations r√©actionnelles">Tumeurs vasculaires et prolif√©rations r√©actionnelles</button>
          <button class="category-item" data-category="Tumeurs fr√©quentes des tissus mous/ Prolif√©rations">Tumeurs fr√©quentes des tissus mous/ Prolif√©rations</button>
          <button class="category-item" data-category="Mastocytose">Mastocytose</button>

          <button class="category-item" data-category="Lymphomes cutan√©s √† cellules B">Lymphomes cutan√©s √† cellules B</button>
          <button class="category-item" data-category="Lymphomes cutan√©s √† cellules T">Lymphomes cutan√©s √† cellules T</button>
          <button class="category-item" data-category="Autres maladies lymphoprolif√©ratives et my√©loprolif√©ratives">Autres maladies lymphoprolif√©ratives et my√©loprolif√©ratives</button>
          <button class="category-item" data-category="M√©tastases cutan√©es">M√©tastases cutan√©es</button>
        </div>
      </aside>

      <!-- Partie droite : titre + recherche + cartes -->
      <main class="main">
        <!-- Titre + recherche -->
        <div class="top-bar">
          <h1 class="title">
            Flashcards Bolognia
            <span class="subtitle-name">‚Äì Myriam ZERROUDI</span>
          </h1>
          <div class="header-search">
            <input id="searchInput" type="text" placeholder="Rechercher un mot..." />
            <button id="searchBtn">Chercher</button>
          </div>
        </div>

        <!-- Mode r√©vision -->
        <section id="reviewMode">
  <div class="review-layout">
    <div class="review-left">
      <div id="card" class="card"></div>
    </div>
    <div class="controls-column">
      <button id="prevBtn">Pr√©c√©dente</button>
      <button id="flipBtn">Retourner Q/R</button>
      <button id="knowBtn" class="btn-know">Je sais ‚úÖ</button>
      <button id="errorBtn" class="btn-error">√Ä revoir ‚ùå</button>
    </div>
  </div>
  <div id="info" class="info"></div>
</section>


        <!-- Mode recherche -->
        <section id="searchMode" class="search-mode" style="display:none;">
          <div class="search-mode-header">
            <h2>R√©sultats de recherche</h2>
            <p class="search-query-label">
              Mot(s) recherch√©(s) : <span id="searchQueryLabel"></span>
            </p>
            <button id="exitSearchBtn">Retour au mode r√©vision</button>
          </div>
          <div id="searchResults" class="search-results"></div>
        </section>
      </main>
    </div>
  </div>

  <script>
    // =========================
    // Donn√©es des cartes
    // =========================
    const allCards = [
      {
        category: "Urticaire et angio-oed√®me",
        front: "Que montre cette image ?",
        back: "Urticaire annulaire g√©ante.",
        image: "urticaire annulaire geÃÅante p30.png",
        caption: "Photographie clinique d‚Äôurticaire annulaire g√©ante (Bolognia p.30)."
      },
      {
        category: "Pemphigus",
        front: "Que montre cette image ?",
        back: "Pemphigo√Øde vulgaire",
        image: "PV p231.png",
        caption: "PV : bulles fragiles, √©ph√©m√®res et se rompant facilement, laissant des cro√ªtes et √©rosions qui deviennent extensives."
      },
      {
        category: "Pemphigus",
        front: "Que montre cette image ?",
        back: "Pemphigo√Øde bulleuse",
        image: "PB.png",
        caption: "Dans la PB, de multiples bulles tendues sont observ√©es ; le contenu des bulles est habituellement s√©reux comme chez ce patient. Les bulles ont une dur√©e de vie sup√©rieure √† celles du PV, mais peuvent √©ventuellement se rompre, conduisant √† des √©rosions et des cro√ªtes."
      },
      {
        category: "Pemphigus",
        front: "Que montre cette image ?",
        back: "Pemphigus vulgaire",
        image: "PV muq.png",
        caption: "Presque tous les patients d√©veloppent des √©rosions douloureuses de la muqueuse orale, les localisations les plus habituelles √©tant les muqueuses buccale et palatine, mais des l√©sions peuvent aussi se d√©velopper sur la gencive et la langue."
      },
      {
        category: "Pemphigus",
        front: "Que montre cette image ?",
        back: "Pemphigus vulgaire",
        image: "PV.png",
        caption: "Les v√©sicules et bulles flasques sont fragiles et se rompent facilement, laissant des √©rosions. Une r√©ponse v√©g√©tante peut occasionnellement √™tre observ√©e dans les l√©sions chroniques r√©calcitrantes."
      },
      {
        category: "Pemphigus",
        front: "Que montre cette image ?",
        back: "Pemphigus v√©g√©tant",
        image: "pemphi v.png",
        caption: "Plaques papillomateuses √©tendues, v√©g√©tantes, √©paisses, survenant en conjonction avec des √©rosions. Les l√©sions cicatris√©es montrent une hyperpigmentation post-inflammatoire r√©siduelle."
      },
      {
        category: "Pemphigus",
        front: "Que montre cette image ?",
        back: "Pemphigus foliac√©",
        image: "PF.png",
        caption: "Plusieurs √©rosions survenant sur une base √©ryth√©mateuse ainsi que des squames-cro√ªtes caract√©ristiques, variables en √©paisseur. Un site fr√©quent d‚Äôatteinte est le tronc. Quand la maladie progresse, les l√©sions deviennent confluentes ; comme les v√©sicules sont fragiles et se rompent facilement, seules des √©rosions avec squames-cro√ªtes sont observ√©es."
      },
      {
        category: "Pemphigus",
        front: "Que montre cette image ?",
        back: "Pemphigus √©ryth√©mateux",
        image: "PE.png",
        caption: "Plaques √©ryth√©mateuses avec des squames-cro√ªtes et des √©rosions sur le nez et les joues. Initialement consid√©r√©e comme une combinaison de pemphigus vulgaire et de lupus √©ryth√©mateux, cette affection est aujourd‚Äôhui class√©e comme une variante localis√©e de pemphigus foliac√©."
      },
      {
        category: "Pemphigus",
        front: "Que montre cette image ?",
        back: "Pemphigus paran√©oplasique",
        image: "PP.png",
        caption: "√ârosions associ√©es √† des cro√ªtes h√©morragiques, pouvant s‚Äô√©tendre sur la l√®vre vermillon et atteindre la muqueuse nasale ; la l√©sion du menton ressemble √† un pemphigus vulgaire."
      },
      {
        category: "Prurit et dysesth√©sies",
        front: "Que montre cette image ?",
        back: "X√©rose et prurit chez un patient ayant une insuffisance r√©nale terminale en h√©modialyse.",
        image: "1.png",
        caption: "Il y a des papules peu nombreuses d'une dermatose perforante acquise m√©lang√©es √† des stries de grattage."
      },
      {
        category: "Prurit et dysesth√©sies",
        front: "Que montre cette image ?",
        back: "Dermographisme",
        image: "2.png",
        caption: "Stries d'urticaire lin√©aires induites par le grattage de la peau. Une recherche de dermographisme doit √™tre effectu√©e chez tous les patients qui ont un prurit."
      },
      {
        category: "Prurit et dysesth√©sies",
        front: "Que montre cette image ?",
        back: "Prurigo nodulaire",
        image: "3.png",
        caption: "Papulonodules fermes, hyperpigment√©s sur la face d'extension d'un avant-bras, cons√©quences de grattages et d'excoriations r√©p√©t√©s. Papulonodules et plaques √† diff√©rents stades sur les genoux d'un patient qui a une dermatite atopique."
      },
      {
        category: "Prurit et dysesth√©sies",
        front: "Que montre cette image ?",
        back: "Multiples l√©sions de prurigo nodulaire",
        image: "4.png",
        caption: "L√©sions hyperpigment√©es multiples sur les zones de grattage chronique."
      },
      {
        category: "Prurit et dysesth√©sies",
        front: "Que montre cette image ?",
        back: "Lichen simplex chronique",
        image: "5.png",
        caption: "Plaque lich√©nifi√©e avec accentuation des marques cutan√©es, cons√©quence d'un grattage chronique."
      },
      {
        category: "Prurit et dysesth√©sies",
        front: "Que montre cette image ?",
        back: "Syndrome trophique trig√©min√©",
        image: "6.png",
        caption: "Ulc√©ration localis√©e de l'aile nasale et de la joue adjacente."
      },
      {
        category: "Prurit et dysesth√©sies",
        front: "Que montre cette image ?",
        back: "Syndrome douloureux r√©gional complexe",
        image: "7.png",
        caption: "Atteinte douloureuse avec squames et √©rosions du bout des doigts."
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Plaques psoriasiques",
        image: "8.png",
        caption: "Noter la d√©limitation nette et les squames argent√©es"
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Plaques psoriasiques",
        image: "9.png",
        caption: "Distribution sym√©trique"
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Psoriasis palmoplantaire",
        image: "10.png",
        caption: "Plaques √©ryth√©matosquameuses des plantes (B). Occasionnellement, il peut y avoir une hyperk√©ratose bien d√©limit√©e avec un √©ryth√®me minime (C)."
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Psoriasis g√©nital",
        image: "11.png",
        caption: "A) Plaques √©ryth√©mateuses bien limit√©es avec squames du gland et du fourreau chez un adulte. B) Psoriasis infantile avec une plaque bien d√©limit√©e de la zone des couches, ainsi que du p√©nis et du scrotum, contrastant avec la dermatite atopique o√π la zone des couches est souvent √©pargn√©e."
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Psoriasis en plaques diss√©min√© chronique",
        image: "12.png",
        caption: "-"
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Psoriasis en gouttes",
        image: "13.png",
        caption: "Discr√®tes petites papules et plaques de psoriasis en gouttes."
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Psoriasis pustuleux",
        image: "14.png",
        caption: "Grandes zones d'√©ryth√®me avec de nombreuses pustules. La confluence des pustules cr√©e des ¬´ lacs ¬ª de pus."
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Pustulose des paumes et des plantes",
        image: "15.png",
        caption: "De multiples pustules st√©riles sont m√™l√©es √† des macules jaune brun de la paume"
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Psoriasis du cuir chevelu avec extension sur le cou",
        image: "16.png",
        caption: "Noter l'atteinte du conduit auditif externe."
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Psoriasis pustuleux annulaire",
        image: "17.png",
        caption: "Multiples plaques annulaires, inflammatoires, parsem√©es de pustules"
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Acrodermatite continue (de Hallopeau)",
        image: "18.png",
        caption: "√âryth√®me et squames de la partie distale du doigt, pustules dans le lit de l'ongle et perte partielle de la tablette ungu√©ale. "
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Psoriasis invers√©",
        image: "19.png",
        caption: "Plaques √©ryth√©mateuses brillantes des plis sous-mammaires, sans squames. "
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Psoriasis ungu√©al",
        image: "20.png",
        caption: " Les modifications comprennent une onycholyse distale, des d√©pressions punctiformes et des ¬´ taches d'huile ¬ª (couleur saumon)."
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Maladie de Sneddon-Wilkinson",
        image: "21.png",
        caption: " A) Plaques axillaires annulaires et polycycliques. B) Nombreuses pustules sous-corn√©es, fragiles, apparaissant sur un fond d'√©ryth√®me. Coalescence des contenus pustuleux dans certaines des l√©sions les plus √©tendues. Chevauchement significatif avec un psoriasis pustuleux."
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Arthrite psoriasique",
        image: "22.png",
        caption: " Atteinte asym√©trique des articulations interphalangiennes distales (IPD) et proximales (IPP). Un ¬´ doigt en saucisse ¬ª (3e doigt de chaque c√¥t√©) r√©sulte de l'atteinte √† la fois des articulations IPD et IPP"
      },
      {
        category: "Erythrodermie",
        front: "Que montre cette image ?",
        back: "√ârythrodermie psoriasique",
        image: "23.png",
        caption: " La pouss√©e de la maladie √©tait corr√©l√©e √† l'administration de lithium"
      },
      {
        category: "Erythrodermie",
        front: "Que montre cette image ?",
        back: "√ârythrodermie due √† une dermatite atopique",
        image: "24.png",
        caption: "√âryth√®me g√©n√©ralis√©, petites squames blanches et prurit en plus d'une p√¢leur p√©riorale chez ce nourrisson."
      },
      {
        category: "Erythrodermie",
        front: "Que montre cette image ?",
        back: "√ârythrodermie secondaire √† un pityriasis rubra pilaire",
        image: "25.png",
        caption: "A) De rares √Ælots √©pargn√©s sont not√©s sur le flanc et la poitrine. B) De grandes squames fines sont observ√©es, de m√™me que la couleur distinctive de saumon √† rouge orange. "
      },
      {
        category: "Erythrodermie",
        front: "Que montre cette image ?",
        back: "√ârythrodermie idiopathique",
        image: "26.png",
        caption: "C'est le type de patient qui n√©cessite des √©valuations dans le temps pour exclure le d√©veloppement d'un lymphome cutan√© √† cellules T"
      },
      {
        category: "Erythrodermie",
        front: "Que montre cette image ?",
        back: "√ârythrodermie due √† un pemphigus foliac√©",
        image: "27.png",
        caption: "√âryth√®me g√©n√©ralis√© avec squames-cro√ªtes diffuses et vastes surfaces √©rosives"
      },
      {
        category: "Erythrodermie",
        front: "Que montre cette image ?",
        back: "√ârythrodermie avec desquamation",
        image: "28.png",
        caption: "Exfoliation manifeste de squames avec √©ryth√®me sous-jacent."
      },
      {
        category: "Erythrodermie",
        front: "Que montre cette image ?",
        back: "K√©ratoses s√©borrh√©iques √©ruptives",
        image: "29.png",
        caption: "chez un patient qui a une √©rythrodermie idiopathique"
      },
      {
        category: "Erythrodermie",
        front: "Que montre cette image ?",
        back: "Ectropion dans le contexte d'une √©rythrodermie.",
        image: "30.png",
        caption: "-"
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Dermatite atopique du nourrisson",
        image: "31.png",
        caption: "√âryth√®me et squames-cro√ªtes des joues avec respect de la partie centrale du visage."
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Dermatite atopique extensive",
        image: "32.png",
        caption: "A DA de la face d‚Äôextension du membre sup√©rieur d‚Äôun nourrisson, qui est une zone habituelle dans ce groupe d‚Äô√¢ge. Noter la pr√©dominance folliculaire sur le tronc. B L√©sions nummulaires de la face d‚Äôextension du membre sup√©rieur chez un nourrisson ayant une DA diss√©min√©e. Noter l‚Äôecz√©ma du mamelon."
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Dermatite atopique",
        image: "33.png",
        caption: "Ecz√©ma du creux poplit√© avec excoriations et cro√ªtes h√©morragiques"
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Dermatite atopique",
        image: "34.png",
        caption: "Lich√©nification, squames, et excoriations ponctu√©es du pli des coudes."
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Dermatite atopique",
        image: "35.png",
        caption: "Plaques ecz√©mateuses √©paisses avec excoriations "
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Dermatite atopique",
        image: "36.png",
        caption: "Papules coalescentes et lich√©nification de la cheville due √† un grattage chronique et des frictions."
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Dermatite atopique",
        image: "37.png",
        caption: "lich√©nification marqu√©e (E) du dos de la main et du poignet."
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Dermatite atopique",
        image: "38.png",
        caption: "L√©sions papuleuses chroniques r√©sultant de frictions et de grattages dans le cadre d‚Äôune maladie de dur√©e longue"
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Dermatite atopique",
        image: "39.png",
        caption: "B L√©sions de prurigo se pr√©sentant sous forme de papules fermes, en d√¥me, et en nodules avec une cro√ªte centrale h√©morragique. C Plaques nummulaires avec suintements et cro√ªtes sur les membres inf√©rieurs."
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Dermatite atopique faciale s√©v√®re chez un adulte",
        image: "40.png",
        caption: "-"
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Plis de Dennie-Morgan (¬´ plis atopiques ¬ª) ",
        image: "41.png",
        caption: "Manifestations associ√©es √† la dermatite atopique."
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Hypo ou hyperpigmentation post-inflammatoire sur les zones de l√©sions ecz√©mateuses ant√©rieures",
        image: "42.png",
        caption: "Manifestations associ√©es √† la dermatite atopique."
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Hyperstriation palmoplantaire",
        image: "43.png",
        caption: "Manifestations associ√©es √† la dermatite atopique."
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "K√©ratose pilaire",
        image: "44.png",
        caption: "Manifestations associ√©es chez des patients ayant une dermatite atopique."
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "K√©ratose pilaire rouge sur la partie lat√©rale du visage",
        image: "45.png",
        caption: "Manifestations associ√©es chez des patients ayant une dermatite atopique. Cette variante est caract√©ris√©e par des minuscules papules folliculaires, comme des grains, par-dessus un √©ryth√®me confluent"
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Pityriasis alba",
        image: "46.png",
        caption: "Manifestations associ√©es chez des patients ayant une dermatite atopique. Noter les fines squames associ√©es √† des macules et des plaques hypopigment√©es des joues."
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: " Dermatite infect√©e de la main chez un patient ayant une dermatite atopique",
        image: "47.png",
        caption: " Il y a des cro√ªtes de type imp√©tigo ainsi que des pustules. "
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "  Syndrome de Kaposi-Juliusberg (eczema herpeticum).",
        image: "48.png",
        caption: " Noter les √©rosions monomorphes et les cro√ªtes h√©morragiques du bras (A) et de la nuque (B). Les v√©sicules sont rarement √©videntes."
      },
      {
        category: "Dermoscopie",
        front: "Que montre cette image ?",
        back: "Hyperplasie s√©bac√©e",
        image: "49.png",
        caption: "Follicule dilat√© central avec glande s√©bac√©e ‚Äúpop corn sign‚Äù plein et plexus sous papillaire qui donne un effet t√©langiectasique en p√©riph√©rie mais ne passe pas le centre de la l√©sion (=/= du CBC)"
      },
      {
        category: "Dermoscopie",
        front: "Que montre cette image ?",
        back: "Hyperplasie s√©bac√©e",
        image: "50.png",
        caption: "Follicule dilat√© central avec glande s√©bac√©e ‚Äúpop corn sign‚Äù plein et plexus sous papillaire qui donne un effet t√©langiectasique en p√©riph√©rie mais ne passe pas le centre de la l√©sion (=/= du CBC)"
      },
      {
        category: "Dermoscopie",
        front: "Que montre cette image ?",
        back: "Hyperplasie s√©bac√©e",
        image: "51.png",
        caption: "Follicule dilat√© central avec glande s√©bac√©e ‚Äúpop corn sign‚Äù plein et plexus sous papillaire qui donne un effet t√©langiectasique en p√©riph√©rie mais ne passe pas le centre de la l√©sion (=/= du CBC)"
      },
      {
        category: "Pemphigus",
        front: "Que montre cette image ?",
        back: "Pemphigus √† IgA - type dermatose pustuleuse sous-corn√©enne",
        image: "PIgA.png",
        caption: "Noter le respect de la partie sup√©rieure et m√©diane du dos (¬´ signe du papillon ¬ª)."
      }
    ];

    // =========================
    // Verrou d'acc√®s (code 1234)
    // =========================
    const ACCESS_KEY = "bologniaAccess_v1";
    const CORRECT_CODE = "1234";

    const lockScreenEl = document.getElementById("lockScreen");
    const appEl = document.getElementById("app");
    const codeInput = document.getElementById("codeInput");
    const codeBtn = document.getElementById("codeBtn");
    const codeError = document.getElementById("codeError");

    function grantAccess() {
      lockScreenEl.style.display = "none";
      appEl.style.display = "block";
      try {
        localStorage.setItem(ACCESS_KEY, "ok");
      } catch (e) {}
    }

    function showLock() {
      lockScreenEl.style.display = "flex";
      appEl.style.display = "none";
      if (codeInput) {
        setTimeout(() => codeInput.focus(), 50);
      }
    }

    function checkCodeAndEnter() {
      const val = (codeInput.value || "").trim();
      if (val === CORRECT_CODE) {
        codeError.style.display = "none";
        grantAccess();
      } else {
        codeError.style.display = "block";
      }
    }

    codeBtn.addEventListener("click", checkCodeAndEnter);
    codeInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        checkCodeAndEnter();
      }
    });

    try {
      if (localStorage.getItem(ACCESS_KEY) === "ok") {
        grantAccess();
      } else {
        showLock();
      }
    } catch (e) {
      showLock();
    }

    // =========================
    // Sauvegarde locale des erreurs
    // =========================
    const STORAGE_KEY = "bologniaErreurs_v1";
    let erreurIds = [];

    try {
      const stored = localStorage.getItem(STORAGE_KEY);
      if (stored) {
        const parsed = JSON.parse(stored);
        if (Array.isArray(parsed)) {
          erreurIds = parsed;
        }
      }
    } catch (e) {
      erreurIds = [];
    }

    function saveErreurs() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(erreurIds));
      } catch (e) {}
    }

    // =========================
    // √âtat courant
    // =========================
    let currentCategory = "Al√©atoire";
    let filteredCards = [];
    let currentIndex = 0;
    let isFront = true;

    const cardEl = document.getElementById("card");
    const infoEl = document.getElementById("info");
    const prevBtn = document.getElementById("prevBtn");
    const flipBtn = document.getElementById("flipBtn");
    const knowBtn = document.getElementById("knowBtn");
    const errorBtn = document.getElementById("errorBtn");
    const categoryButtons = document.querySelectorAll(".category-item");

    const reviewModeEl = document.getElementById("reviewMode");
    const searchModeEl = document.getElementById("searchMode");
    const searchResultsEl = document.getElementById("searchResults");
    const searchQueryLabel = document.getElementById("searchQueryLabel");
    const exitSearchBtn = document.getElementById("exitSearchBtn");
    const searchInput = document.getElementById("searchInput");
    const searchBtn = document.getElementById("searchBtn");

    function shuffleArray(arr) {
      const a = [...arr];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function buildErrorsCards() {
      return erreurIds.map(idx => allCards[idx]).filter(Boolean);
    }

    function enterSearchMode() {
      reviewModeEl.style.display = "none";
      searchModeEl.style.display = "block";
    }

    function exitSearchMode() {
      searchModeEl.style.display = "none";
      reviewModeEl.style.display = "block";
    }

    function applyCategory(categoryName) {
      currentCategory = categoryName;

      if (categoryName === "Al√©atoire") {
        filteredCards = shuffleArray(allCards);
      } else if (categoryName === "Erreurs") {
        filteredCards = buildErrorsCards();
      } else {
        filteredCards = allCards.filter(card => card.category === categoryName);
      }

      currentIndex = 0;
      isFront = true;
      renderCard();
    }

    function renderCard() {
      if (!filteredCards || filteredCards.length === 0) {
    cardEl.innerHTML = "<div>Aucune carte pour cette cat√©gorie pour l‚Äôinstant.</div>";
    infoEl.textContent = "";
    prevBtn.disabled = true;
    flipBtn.disabled = true;
    knowBtn.disabled = true;
    errorBtn.disabled = true;
    errorBtn.classList.remove("active-error");
    return;
  }

  const current = filteredCards[currentIndex];

  // üëâ Texte √† l‚Äôint√©rieur de la carte, SANS "Question :" ni "R√©ponse :"
  const mainText = isFront
    ? (current.front || "")
    : (current.back || "");

  let html = "";

  if (mainText) {
    html += `<div class="card-text">${mainText}</div>`;
  }

  // Image toujours dans la carte
  if (current.image) {
    html += `<img src="${current.image}" alt="Image de la carte">`;
  }

  // L√©gende seulement c√¥t√© r√©ponse
  if (current.caption && !isFront) {
    html += `<p class="caption">${current.caption}</p>`;
  }

  if (!html) {
    html = "<div>Aucun contenu pour cette carte.</div>";
  }

  cardEl.innerHTML = html;

  // üëâ Ligne d‚Äôinfo SANS les mots "Question"/"R√©ponse"
  infoEl.textContent =
    `Cat√©gorie : ${currentCategory} ‚Äî Carte ${currentIndex + 1} / ${filteredCards.length}`;

  prevBtn.disabled = currentIndex === 0;
  flipBtn.disabled = false;
  knowBtn.disabled = false;
  errorBtn.disabled = false;

  const globalIndex = allCards.indexOf(current);
  const isError = globalIndex !== -1 && erreurIds.includes(globalIndex);
  errorBtn.classList.toggle("active-error", isError);
}

    function markErrorForCurrent() {
      if (!filteredCards.length) return;
      const current = filteredCards[currentIndex];
      const idx = allCards.indexOf(current);
      if (idx === -1) return;
      if (!erreurIds.includes(idx)) {
        erreurIds.push(idx);
        saveErreurs();
      }
    }

    function unmarkErrorForCurrent() {
      if (!filteredCards.length) return;
      const current = filteredCards[currentIndex];
      const idx = allCards.indexOf(current);
      if (idx === -1) return;
      const pos = erreurIds.indexOf(idx);
      if (pos !== -1) {
        erreurIds.splice(pos, 1);
        saveErreurs();
      }
    }

    function goNextStandard() {
      if (currentIndex < filteredCards.length - 1) {
        currentIndex++;
      }
      isFront = true;
      renderCard();
    }

    // Petit flash color√© sur la carte
    function flashCard(color) {
      cardEl.style.backgroundColor = color;
      setTimeout(() => {
        cardEl.style.backgroundColor = "white";
      }, 200);
    }

    // ============== Recherche ==============
    function performSearch() {
      const q = (searchInput.value || "").trim().toLowerCase();
      if (!q) return;

      const words = q.split(/\s+/).filter(Boolean);

      const results = allCards
        .map((card, index) => ({ card, index }))
        .filter(({ card }) => {
          const text = (
            (card.front || "") + " " +
            (card.back || "") + " " +
            (card.caption || "") + " " +
            (card.category || "")
          ).toLowerCase();

          return words.every(w => text.includes(w));
        });

      renderSearchResults(q, results);
      enterSearchMode();
    }

    function renderSearchResults(query, results) {
      searchQueryLabel.textContent = query;

      if (!results.length) {
        searchResultsEl.innerHTML = "<p>Aucune carte ne contient ce(s) mot(s).</p>";
        return;
      }

      let html = "";
      results.forEach(({ card, index }, i) => {
        html += `
          <article class="search-card">
            <div class="search-card-header">
              <span class="search-card-index">#${i + 1}</span>
              <span class="search-card-category">${card.category || "Sans cat√©gorie"}</span>
            </div>
        `;
        if (card.image) {
          html += `<img src="${card.image}" alt="Image de la carte">`;
        }
        html += `
            <div class="search-card-front"><strong>Question :</strong> ${card.front || ""}</div>
            <div class="search-card-back"><strong>R√©ponse :</strong> ${card.back || ""}</div>
        `;
        if (card.caption) {
          html += `<div class="search-card-caption"><strong>L√©gende :</strong> ${card.caption}</div>`;
        }
        html += `
            <button class="search-card-jump" data-index="${index}">R√©viser cette carte</button>
          </article>
        `;
      });

      searchResultsEl.innerHTML = html;
    }

    function jumpToCard(globalIndex) {
      const card = allCards[globalIndex];
      if (!card) return;

      const targetCategory = card.category || "Al√©atoire";

      categoryButtons.forEach(b => {
        b.classList.toggle("active", b.dataset.category === targetCategory);
      });

      applyCategory(targetCategory);

      const idxInFiltered = filteredCards.findIndex(c => c === card);
      if (idxInFiltered !== -1) {
        currentIndex = idxInFiltered;
        isFront = true;
        renderCard();
      }

      exitSearchMode();
    }

    // =========================
    // √âv√©nements
    // =========================
    // Click sur la carte = flip Q/R
    cardEl.addEventListener("click", () => {
      if (!filteredCards.length) return;
      isFront = !isFront;
      renderCard();
    });

    // Click sur le texte Q/R au-dessus = flip aussi

    flipBtn.addEventListener("click", () => {
      if (!filteredCards.length) return;
      isFront = !isFront;
      renderCard();
    });

    prevBtn.addEventListener("click", () => {
      if (currentIndex > 0) {
        currentIndex--;
        isFront = true;
        renderCard();
      }
    });

    // ‚ùå √Ä revoir : ajoute aux erreurs + passe √† la suivante + flash rouge
    errorBtn.addEventListener("click", () => {
      if (!filteredCards.length) return;

      flashCard("#fee2e2");

      if (currentCategory !== "Erreurs") {
        markErrorForCurrent();
        goNextStandard();
      } else {
        goNextStandard();
      }
    });

    // ‚úÖ Je sais : retire des erreurs + passe √† la suivante + flash vert
    knowBtn.addEventListener("click", () => {
      if (!filteredCards.length) return;

      flashCard("#dcfce7");

      if (currentCategory === "Erreurs") {
        const previousIndex = currentIndex;
        unmarkErrorForCurrent();
        filteredCards = buildErrorsCards();

        if (filteredCards.length === 0) {
          renderCard();
          return;
        }

        if (previousIndex >= filteredCards.length) {
          currentIndex = filteredCards.length - 1;
        } else {
          currentIndex = previousIndex;
        }
        isFront = true;
        renderCard();
      } else {
        unmarkErrorForCurrent();
        goNextStandard();
      }
    });

    categoryButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        categoryButtons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        const cat = btn.dataset.category;
        exitSearchMode();
        applyCategory(cat);
      });
    });

    // Recherche : bouton + Entr√©e
    searchBtn.addEventListener("click", () => {
      performSearch();
    });

    searchInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        performSearch();
      }
    });

    exitSearchBtn.addEventListener("click", () => {
      exitSearchMode();
    });

    searchResultsEl.addEventListener("click", (e) => {
      const btn = e.target.closest(".search-card-jump");
      if (!btn) return;
      const idx = parseInt(btn.dataset.index, 10);
      if (!Number.isNaN(idx)) {
        jumpToCard(idx);
      }
    });

    // ============== Raccourcis clavier ==============
    document.addEventListener("keydown", (e) => {
      // Si l'√©cran de code est visible, on ignore
      if (lockScreenEl.style.display !== "none") return;

      const target = e.target;
      // Ne pas intercepter quand on tape dans les champs
      if (target === searchInput || target === codeInput) return;

      if (e.key === " ") {
        e.preventDefault();
        if (!filteredCards.length) return;
        isFront = !isFront;
        renderCard();
      } else if (e.key === "ArrowLeft") {
        if (currentIndex > 0) {
          currentIndex--;
          isFront = true;
          renderCard();
        }
      } else if (e.key === "1") {
        e.preventDefault();
        knowBtn.click();
      } else if (e.key === "2") {
        e.preventDefault();
        errorBtn.click();
      }
    });

    // Initialisation
    applyCategory("Al√©atoire");
  </script>
</body>
</html>





