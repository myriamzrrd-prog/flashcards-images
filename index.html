<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Flashcards Bolognia - Myriam ZERROUDI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      background: #f5f5f5;
    }

    /* ======================
       ÉCRAN DE CODE / VERROU
       ====================== */
    .lock-screen {
      position: fixed;
      inset: 0;
      background: #0f172a;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      z-index: 1000;
    }

    .lock-card {
      background: white;
      border-radius: 16px;
      padding: 24px 20px;
      max-width: 360px;
      width: 100%;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    }

    .lock-card h1 {
      font-size: 1.4rem;
      margin-bottom: 4px;
      color: #111827;
    }

    .lock-card p {
      font-size: 0.9rem;
      margin: 4px 0 12px;
      color: #4b5563;
    }

    .lock-input {
      width: 100%;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      font-size: 0.95rem;
      margin-bottom: 10px;
      outline: none;
    }

    .lock-input:focus {
      border-color: #111827;
    }

    .lock-btn {
      width: 100%;
      padding: 8px 10px;
      border-radius: 999px;
      border: none;
      background: #111827;
      color: white;
      font-size: 0.95rem;
      cursor: pointer;
    }

    .lock-btn:hover {
      background: #020617;
    }

    .lock-error {
      margin-top: 8px;
      color: #b91c1c;
      font-size: 0.85rem;
    }

    /* ======================
       LAYOUT GLOBAL
       ====================== */
    .layout {
      display: flex;
      min-height: 100vh;
    }

    /* Colonne de gauche (catégories) */
    .sidebar {
      width: 260px;
      background: #111827;
      color: #e5e7eb;
      padding: 16px 12px;
      display: flex;
      flex-direction: column;
    }

    .sidebar h2 {
      font-size: 1rem;
      margin: 0 0 8px;
    }

    .category-list {
      margin-top: 8px;
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 6px;
      padding-right: 4px;
    }

    .category-item {
      text-align: left;
      padding: 6px 8px;
      border-radius: 8px;
      border: none;
      background: transparent;
      color: inherit;
      font-size: 0.85rem;
      cursor: pointer;
    }

    .category-item:hover {
      background: rgba(255, 255, 255, 0.12);
    }

    .category-item.active {
      background: #f9fafb;
      color: #111827;
      font-weight: 600;
    }

    /* Erreurs (rouge clair) */
    .category-item[data-category="Erreurs"] {
      background: #fee2e2;
      color: #991b1b;
    }

    .category-item[data-category="Erreurs"]:hover {
      background: #fecaca;
    }

    .category-item[data-category="Erreurs"].active {
      background: #fecaca;
      color: #7f1d1d;
    }

    /* Aléatoire (rose pastel) */
    .category-item[data-category="Aléatoire"] {
      background: #fce7f3;
      color: #9d174d;
    }

    .category-item[data-category="Aléatoire"]:hover {
      background: #fbcfe8;
    }

    .category-item[data-category="Aléatoire"].active {
      background: #fbcfe8;
      color: #831843;
      font-weight: 600;
    }

    /* Dermoscopie (vert clair) */
    .category-item[data-category="Dermoscopie"] {
      background: #dcfce7;
      color: #166534;
    }

    .category-item[data-category="Dermoscopie"]:hover {
      background: #bbf7d0;
    }

    .category-item[data-category="Dermoscopie"].active {
      background: #bbf7d0;
      color: #14532d;
      font-weight: 600;
    }

    /* ======================
       PARTIE DROITE
       ====================== */
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 16px;
      padding: 24px;
      align-items: center;
    }

    /* Bandeau titre + recherche */
    .top-bar {
      width: 100%;
      max-width: 900px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      flex-wrap: wrap;
    }

    .title {
      font-size: 1.8rem;
      font-weight: 600;
      margin: 0;
      color: #111827;
      display: flex;
      align-items: baseline;
      gap: 4px;
    }

    .subtitle-name {
      font-size: 0.9rem;
      font-weight: 400;
      opacity: 0.75;
    }

    .header-search {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: nowrap;
    }

    .header-search input {
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      font-size: 1rem;
      min-width: 240px;
      max-width: 320px;
      outline: none;
    }

    .header-search input::placeholder {
      color: #9ca3af;
    }

    .header-search button {
      padding: 8px 12px;
      border-radius: 999px;
      border: none;
      background: #111827;
      color: white;
      font-size: 0.9rem;
      cursor: pointer;
      white-space: nowrap;
    }

    .header-search button:hover {
      background: #020617;
    }

    /* Carte de flashcard */
    #reviewMode {
      width: 100%;
      max-width: 900px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .card {
      width: 100%;
      max-width: 700px;
      min-height: 40vh;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      text-align: center;
      font-size: 1rem;
      cursor: pointer;
      user-select: none;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
    }

    .card-text {
      font-size: 1.2rem;
    }

    .caption {
      margin-top: 8px;
      font-size: 1.5rem;
      color: #6b7280;
    }

    /* Image dans la carte : plus grande, cadre inchangé */
    #card img {
      width: 65%;      /* agrandies */
      height: auto;
      display: block;
      margin: 0 auto 12px;
      border-radius: 12px;
    }

    .controls {
      margin-top: 8px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
    }

    button {
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: #111827;
      color: white;
      font-size: 0.9rem;
    }

    button:disabled {
      opacity: 0.4;
      cursor: default;
    }

    .btn-know {
      background: #16a34a;
    }

    .btn-error {
      background: #dc2626;
    }

    .btn-error.active-error {
      box-shadow: 0 0 0 2px #fecaca;
    }

    .info {
      margin-top: 4px;
      font-size: 0.85rem;
      color: #6b7280;
      text-align: center;
    }

    /* Mode recherche : liste de cartes */
    .search-mode {
      width: 100%;
      max-width: 900px;
    }

    .search-mode-header {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      justify-content: space-between;
      margin-top: 12px;
      margin-bottom: 12px;
    }

    .search-mode-header h2 {
      font-size: 1.1rem;
      margin: 0;
    }

    .search-query-label {
      font-size: 0.9rem;
      color: #4b5563;
      margin: 0;
    }

    #exitSearchBtn {
      font-size: 0.8rem;
      padding: 6px 10px;
      border-radius: 999px;
      border: none;
      background: #111827;
      color: white;
      cursor: pointer;
      white-space: nowrap;
    }

    .search-results {
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: 60vh;
      overflow-y: auto;
      padding-right: 4px;
    }

    .search-card {
      background: white;
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
      text-align: left;
    }

    .search-card-header {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      margin-bottom: 6px;
      color: #6b7280;
    }

    .search-card-index {
      font-weight: 500;
    }

    .search-card-category {
      font-weight: 500;
    }

    .search-card img {
      width: 40%;
      max-width: 260px;
      height: auto;
      display: block;
      margin-bottom: 8px;
      border-radius: 8px;
    }

    .search-card-front,
    .search-card-back,
    .search-card-caption {
      font-size: 0.9rem;
      margin-bottom: 4px;
    }

    .search-card-jump {
      margin-top: 6px;
      font-size: 0.8rem;
      padding: 6px 10px;
      border-radius: 999px;
      border: none;
      background: #111827;
      color: white;
      cursor: pointer;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .layout {
        flex-direction: column;
      }
      .sidebar {
        width: 100%;
        max-height: 260px;
      }
      .card {
        width: 100%;
        min-height: 50vh;
      }
      #card img {
        width: 80%;
      }
      .search-card img {
        width: 60%;
      }
      .top-bar {
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <!-- ÉCRAN DE CODE -->
  <div id="lockScreen" class="lock-screen">
    <div class="lock-card">
      <h1>Flashcards Bolognia</h1>
      <p>Accès réservé – entre le code :</p>
      <input
        id="codeInput"
        type="password"
        class="lock-input"
        placeholder="Code d’accès"
      >
      <button id="codeBtn" class="lock-btn">Valider</button>
      <p id="codeError" class="lock-error" style="display:none;">Code incorrect</p>
    </div>
  </div>

  <!-- APP PRINCIPALE -->
  <div id="app" style="display:none;">
    <div class="layout">
      <!-- Colonne gauche : catégories -->
      <aside class="sidebar">
        <h2>Catégories</h2>
        <div class="category-list">
          <button class="category-item" data-category="Erreurs">Erreurs</button>
          <button class="category-item active" data-category="Aléatoire">Aléatoire</button>
          <button class="category-item" data-category="Dermoscopie">Dermoscopie</button>

          <button class="category-item" data-category="Prurit et dysesthésies">Prurit et dysesthésies</button>
          <button class="category-item" data-category="Affections psychocutanées">Affections psychocutanées</button>
          <button class="category-item" data-category="Psoriasis">Psoriasis</button>
          <button class="category-item" data-category="Autres affections papulosquameuses">Autres affections papulosquameuses</button>
          <button class="category-item" data-category="Erythrodermie">Erythrodermie</button>
          <button class="category-item" data-category="Lichen plan et dermatoses lichénoïdes">Lichen plan et dermatoses lichénoïdes</button>
          <button class="category-item" data-category="Dermatite atopique">Dermatite atopique</button>
          <button class="category-item" data-category="Autres éruptions eczémateuses">Autres éruptions eczémateuses</button>
          <button class="category-item" data-category="Dermatites de contact / pro / aux plantes">Dermatites de contact / pro / aux plantes</button>
          <button class="category-item" data-category="Approche clinique des dermatoses régionales">Approche clinique des dermatoses régionales</button>
          <button class="category-item" data-category="Urticaire et angio-oedème">Urticaire et angio-oedème</button>
          <button class="category-item" data-category="Erythèmes figurés">Erythèmes figurés</button>
          <button class="category-item" data-category="Erythème polymorphe, SJS et NET">Erythème polymorphe, SJS et NET</button>
          <button class="category-item" data-category="Réactions aux médicaments">Réactions aux médicaments</button>
          <button class="category-item" data-category="Purpura et affections dues à une occlusion microvasculaire">Purpura et affections dues à une occlusion microvasculaire</button>
          <button class="category-item" data-category="Vascularites">Vascularites</button>
          <button class="category-item" data-category="Dermatoses éosinophiliques">Dermatoses éosinophiliques</button>
          <button class="category-item" data-category="Dermatoses neutrophiliques">Dermatoses neutrophiliques</button>
          <button class="category-item" data-category="Dermatoses de la grossesse">Dermatoses de la grossesse</button>
          <button class="category-item" data-category="Pemphigus">Pemphigus</button>
          <button class="category-item" data-category="Pemphigoïde et épidermolyse bulleuse acquise">Pemphigoïde et épidermolyse bulleuse acquise</button>
        </div>
      </aside>

      <!-- Partie droite : titre + recherche + cartes -->
      <main class="main">
        <!-- Titre + recherche -->
        <div class="top-bar">
          <h1 class="title">
            Flashcards Bolognia
            <span class="subtitle-name">– Myriam ZERROUDI</span>
          </h1>
          <div class="header-search">
            <input id="searchInput" type="text" placeholder="Rechercher un mot..." />
            <button id="searchBtn">Chercher</button>
          </div>
        </div>

        <!-- Mode révision -->
        <section id="reviewMode">
          <div id="card" class="card"></div>
          <div class="controls">
            <button id="prevBtn">Précédente</button>
            <button id="flipBtn">Retourner Q/R</button>
            <button id="knowBtn" class="btn-know">Je sais ✅</button>
            <button id="errorBtn" class="btn-error">À revoir ❌</button>
          </div>
          <div id="info" class="info"></div>
        </section>

        <!-- Mode recherche -->
        <section id="searchMode" class="search-mode" style="display:none;">
          <div class="search-mode-header">
            <h2>Résultats de recherche</h2>
            <p class="search-query-label">
              Mot(s) recherché(s) : <span id="searchQueryLabel"></span>
            </p>
            <button id="exitSearchBtn">Retour au mode révision</button>
          </div>
          <div id="searchResults" class="search-results"></div>
        </section>
      </main>
    </div>
  </div>

  <script>
    // =========================
    // Données des cartes
    // =========================
    const allCards = [
      {
        category: "Urticaire et angio-oedème",
        front: "Que montre cette image ?",
        back: "Urticaire annulaire géante.",
        image: "urticaire annulaire géante p30.png",
        caption: "Photographie clinique d’urticaire annulaire géante (Bolognia p.30)."
      },
      {
        category: "Pemphigus",
        front: "Que montre cette image ?",
        back: "Pemphigoïde vulgaire",
        image: "PV p231.png",
        caption: "PV : bulles fragiles, éphémères et se rompant facilement, laissant des croûtes et érosions qui deviennent extensives."
      },
      {
        category: "Pemphigus",
        front: "Que montre cette image ?",
        back: "Pemphigoïde bulleuse",
        image: "PB.png",
        caption: "Dans la PB, de multiples bulles tendues sont observées ; le contenu des bulles est habituellement séreux comme chez ce patient. Les bulles ont une durée de vie supérieure à celles du PV, mais peuvent éventuellement se rompre, conduisant à des érosions et des croûtes."
      },
      {
        category: "Pemphigus",
        front: "Que montre cette image ?",
        back: "Pemphigus vulgaire",
        image: "PV muq.png",
        caption: "Presque tous les patients développent des érosions douloureuses de la muqueuse orale, les localisations les plus habituelles étant les muqueuses buccale et palatine, mais des lésions peuvent aussi se développer sur la gencive et la langue."
      },
      {
        category: "Pemphigus",
        front: "Que montre cette image ?",
        back: "Pemphigus vulgaire",
        image: "PV.png",
        caption: "Les vésicules et bulles flasques sont fragiles et se rompent facilement, laissant des érosions. Une réponse végétante peut occasionnellement être observée dans les lésions chroniques récalcitrantes."
      },
      {
        category: "Pemphigus",
        front: "Que montre cette image ?",
        back: "Pemphigus végétant",
        image: "pemphi v.png",
        caption: "Plaques papillomateuses étendues, végétantes, épaisses, survenant en conjonction avec des érosions. Les lésions cicatrisées montrent une hyperpigmentation post-inflammatoire résiduelle."
      },
      {
        category: "Pemphigus",
        front: "Que montre cette image ?",
        back: "Pemphigus foliacé",
        image: "PF.png",
        caption: "Plusieurs érosions survenant sur une base érythémateuse ainsi que des squames-croûtes caractéristiques, variables en épaisseur. Un site fréquent d’atteinte est le tronc. Quand la maladie progresse, les lésions deviennent confluentes ; comme les vésicules sont fragiles et se rompent facilement, seules des érosions avec squames-croûtes sont observées."
      },
      {
        category: "Pemphigus",
        front: "Que montre cette image ?",
        back: "Pemphigus érythémateux",
        image: "PE.png",
        caption: "Plaques érythémateuses avec des squames-croûtes et des érosions sur le nez et les joues. Initialement considérée comme une combinaison de pemphigus vulgaire et de lupus érythémateux, cette affection est aujourd’hui classée comme une variante localisée de pemphigus foliacé."
      },
      {
        category: "Pemphigus",
        front: "Que montre cette image ?",
        back: "Pemphigus paranéoplasique",
        image: "PP.png",
        caption: "Érosions associées à des croûtes hémorragiques, pouvant s’étendre sur la lèvre vermillon et atteindre la muqueuse nasale ; la lésion du menton ressemble à un pemphigus vulgaire."
      },
      {
        category: "Prurit et dysesthésies",
        front: "Que montre cette image ?",
        back: "Xérose et prurit chez un patient ayant une insuffisance rénale terminale en hémodialyse.",
        image: "1.png",
        caption: "Il y a des papules peu nombreuses d'une dermatose perforante acquise mélangées à des stries de grattage."
      },
      {
        category: "Prurit et dysesthésies",
        front: "Que montre cette image ?",
        back: "Dermographisme",
        image: "2.png",
        caption: "Stries d'urticaire linéaires induites par le grattage de la peau. Une recherche de dermographisme doit être effectuée chez tous les patients qui ont un prurit."
      },
      {
        category: "Prurit et dysesthésies",
        front: "Que montre cette image ?",
        back: "Prurigo nodulaire",
        image: "3.png",
        caption: "Papulonodules fermes, hyperpigmentés sur la face d'extension d'un avant-bras, conséquences de grattages et d'excoriations répétés. Papulonodules et plaques à différents stades sur les genoux d'un patient qui a une dermatite atopique."
      },
      {
        category: "Prurit et dysesthésies",
        front: "Que montre cette image ?",
        back: "Multiples lésions de prurigo nodulaire",
        image: "4.png",
        caption: "Lésions hyperpigmentées multiples sur les zones de grattage chronique."
      },
      {
        category: "Prurit et dysesthésies",
        front: "Que montre cette image ?",
        back: "Lichen simplex chronique",
        image: "5.png",
        caption: "Plaque lichénifiée avec accentuation des marques cutanées, conséquence d'un grattage chronique."
      },
      {
        category: "Prurit et dysesthésies",
        front: "Que montre cette image ?",
        back: "Syndrome trophique trigéminé",
        image: "6.png",
        caption: "Ulcération localisée de l'aile nasale et de la joue adjacente."
      },
      {
        category: "Prurit et dysesthésies",
        front: "Que montre cette image ?",
        back: "Syndrome douloureux régional complexe",
        image: "7.png",
        caption: "Atteinte douloureuse avec squames et érosions du bout des doigts."
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Plaques psoriasiques",
        image: "8.png",
        caption: "Noter la délimitation nette et les squames argentées"
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Plaques psoriasiques",
        image: "9.png",
        caption: "Distribution symétrique"
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Psoriasis palmoplantaire",
        image: "10.png",
        caption: "Plaques érythématosquameuses des plantes (B). Occasionnellement, il peut y avoir une hyperkératose bien délimitée avec un érythème minime (C)."
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Psoriasis génital",
        image: "11.png",
        caption: "A) Plaques érythémateuses bien limitées avec squames du gland et du fourreau chez un adulte. B) Psoriasis infantile avec une plaque bien délimitée de la zone des couches, ainsi que du pénis et du scrotum, contrastant avec la dermatite atopique où la zone des couches est souvent épargnée."
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Psoriasis en plaques disséminé chronique",
        image: "12.png",
        caption: "-"
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Psoriasis en gouttes",
        image: "13.png",
        caption: "Discrètes petites papules et plaques de psoriasis en gouttes."
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Psoriasis pustuleux",
        image: "14.png",
        caption: "Grandes zones d'érythème avec de nombreuses pustules. La confluence des pustules crée des « lacs » de pus."
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Pustulose des paumes et des plantes",
        image: "15.png",
        caption: "De multiples pustules stériles sont mêlées à des macules jaune brun de la paume"
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Psoriasis du cuir chevelu avec extension sur le cou",
        image: "16.png",
        caption: "Noter l'atteinte du conduit auditif externe."
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Psoriasis pustuleux annulaire",
        image: "17.png",
        caption: "Multiples plaques annulaires, inflammatoires, parsemées de pustules"
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Acrodermatite continue (de Hallopeau)",
        image: "18.png",
        caption: "Érythème et squames de la partie distale du doigt, pustules dans le lit de l'ongle et perte partielle de la tablette unguéale. "
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Psoriasis inversé",
        image: "19.png",
        caption: "Plaques érythémateuses brillantes des plis sous-mammaires, sans squames. "
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Psoriasis unguéal",
        image: "20.png",
        caption: " Les modifications comprennent une onycholyse distale, des dépressions punctiformes et des « taches d'huile » (couleur saumon)."
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Maladie de Sneddon-Wilkinson",
        image: "21.png",
        caption: " A) Plaques axillaires annulaires et polycycliques. B) Nombreuses pustules sous-cornées, fragiles, apparaissant sur un fond d'érythème. Coalescence des contenus pustuleux dans certaines des lésions les plus étendues. Chevauchement significatif avec un psoriasis pustuleux."
      },
      {
        category: "Psoriasis",
        front: "Que montre cette image ?",
        back: "Arthrite psoriasique",
        image: "22.png",
        caption: " Atteinte asymétrique des articulations interphalangiennes distales (IPD) et proximales (IPP). Un « doigt en saucisse » (3e doigt de chaque côté) résulte de l'atteinte à la fois des articulations IPD et IPP"
      },
      {
        category: "Erythrodermie",
        front: "Que montre cette image ?",
        back: "Érythrodermie psoriasique",
        image: "23.png",
        caption: " La poussée de la maladie était corrélée à l'administration de lithium"
      },
      {
        category: "Erythrodermie",
        front: "Que montre cette image ?",
        back: "Érythrodermie due à une dermatite atopique",
        image: "24.png",
        caption: "Érythème généralisé, petites squames blanches et prurit en plus d'une pâleur périorale chez ce nourrisson."
      },
      {
        category: "Erythrodermie",
        front: "Que montre cette image ?",
        back: "Érythrodermie secondaire à un pityriasis rubra pilaire",
        image: "25.png",
        caption: "A) De rares îlots épargnés sont notés sur le flanc et la poitrine. B) De grandes squames fines sont observées, de même que la couleur distinctive de saumon à rouge orange. "
      },
      {
        category: "Erythrodermie",
        front: "Que montre cette image ?",
        back: "Érythrodermie idiopathique",
        image: "26.png",
        caption: "C'est le type de patient qui nécessite des évaluations dans le temps pour exclure le développement d'un lymphome cutané à cellules T"
      },
      {
        category: "Erythrodermie",
        front: "Que montre cette image ?",
        back: "Érythrodermie due à un pemphigus foliacé",
        image: "27.png",
        caption: "Érythème généralisé avec squames-croûtes diffuses et vastes surfaces érosives"
      },
      {
        category: "Erythrodermie",
        front: "Que montre cette image ?",
        back: "Érythrodermie avec desquamation",
        image: "28.png",
        caption: "Exfoliation manifeste de squames avec érythème sous-jacent."
      },
      {
        category: "Erythrodermie",
        front: "Que montre cette image ?",
        back: "Kératoses séborrhéiques éruptives",
        image: "29.png",
        caption: "chez un patient qui a une érythrodermie idiopathique"
      },
      {
        category: "Erythrodermie",
        front: "Que montre cette image ?",
        back: "Ectropion dans le contexte d'une érythrodermie.",
        image: "30.png",
        caption: "-"
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Dermatite atopique du nourrisson",
        image: "31.png",
        caption: "Érythème et squames-croûtes des joues avec respect de la partie centrale du visage."
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Dermatite atopique extensive",
        image: "32.png",
        caption: "A DA de la face d’extension du membre supérieur d’un nourrisson, qui est une zone habituelle dans ce groupe d’âge. Noter la prédominance folliculaire sur le tronc. B Lésions nummulaires de la face d’extension du membre supérieur chez un nourrisson ayant une DA disséminée. Noter l’eczéma du mamelon."
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Dermatite atopique",
        image: "33.png",
        caption: "Eczéma du creux poplité avec excoriations et croûtes hémorragiques"
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Dermatite atopique",
        image: "34.png",
        caption: "Lichénification, squames, et excoriations ponctuées du pli des coudes."
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Dermatite atopique",
        image: "35.png",
        caption: "Plaques eczémateuses épaisses avec excoriations "
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Dermatite atopique",
        image: "36.png",
        caption: "Papules coalescentes et lichénification de la cheville due à un grattage chronique et des frictions."
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Dermatite atopique",
        image: "37.png",
        caption: "lichénification marquée (E) du dos de la main et du poignet."
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Dermatite atopique",
        image: "38.png",
        caption: "Lésions papuleuses chroniques résultant de frictions et de grattages dans le cadre d’une maladie de durée longue"
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Dermatite atopique",
        image: "39.png",
        caption: "B Lésions de prurigo se présentant sous forme de papules fermes, en dôme, et en nodules avec une croûte centrale hémorragique. C Plaques nummulaires avec suintements et croûtes sur les membres inférieurs."
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Dermatite atopique faciale sévère chez un adulte",
        image: "40.png",
        caption: "-"
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Plis de Dennie-Morgan (« plis atopiques ») ",
        image: "41.png",
        caption: "Manifestations associées à la dermatite atopique."
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Hypo ou hyperpigmentation post-inflammatoire sur les zones de lésions eczémateuses antérieures",
        image: "42.png",
        caption: "Manifestations associées à la dermatite atopique."
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Hyperstriation palmoplantaire",
        image: "43.png",
        caption: "Manifestations associées à la dermatite atopique."
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Kératose pilaire",
        image: "44.png",
        caption: "Manifestations associées chez des patients ayant une dermatite atopique."
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Kératose pilaire rouge sur la partie latérale du visage",
        image: "45.png",
        caption: "Manifestations associées chez des patients ayant une dermatite atopique. Cette variante est caractérisée par des minuscules papules folliculaires, comme des grains, par-dessus un érythème confluent"
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "Pityriasis alba",
        image: "46.png",
        caption: "Manifestations associées chez des patients ayant une dermatite atopique. Noter les fines squames associées à des macules et des plaques hypopigmentées des joues."
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: " Dermatite infectée de la main chez un patient ayant une dermatite atopique",
        image: "47.png",
        caption: " Il y a des croûtes de type impétigo ainsi que des pustules. "
      },
      {
        category: "Dermatite atopique",
        front: "Que montre cette image ?",
        back: "  Syndrome de Kaposi-Juliusberg (eczema herpeticum).",
        image: "48.png",
        caption: " Noter les érosions monomorphes et les croûtes hémorragiques du bras (A) et de la nuque (B). Les vésicules sont rarement évidentes."
      },
      {
        category: "Dermoscopie",
        front: "Que montre cette image ?",
        back: "Hyperplasie sébacée",
        image: "49.png",
        caption: "Follicule dilaté central avec glande sébacée “pop corn sign” plein et plexus sous papillaire qui donne un effet télangiectasique en périphérie mais ne passe pas le centre de la lésion (=/= du CBC)"
      },
      {
        category: "Dermoscopie",
        front: "Que montre cette image ?",
        back: "Hyperplasie sébacée",
        image: "50.png",
        caption: "Follicule dilaté central avec glande sébacée “pop corn sign” plein et plexus sous papillaire qui donne un effet télangiectasique en périphérie mais ne passe pas le centre de la lésion (=/= du CBC)"
      },
      {
        category: "Dermoscopie",
        front: "Que montre cette image ?",
        back: "Hyperplasie sébacée",
        image: "51.png",
        caption: "Follicule dilaté central avec glande sébacée “pop corn sign” plein et plexus sous papillaire qui donne un effet télangiectasique en périphérie mais ne passe pas le centre de la lésion (=/= du CBC)"
      },
      {
        category: "Pemphigus",
        front: "Que montre cette image ?",
        back: "Pemphigus à IgA - type dermatose pustuleuse sous-cornéenne",
        image: "PIgA.png",
        caption: "Noter le respect de la partie supérieure et médiane du dos (« signe du papillon »)."
      }
    ];

    // =========================
    // Verrou d'accès (code 1234)
    // =========================
    const ACCESS_KEY = "bologniaAccess_v1";
    const CORRECT_CODE = "1234";

    const lockScreenEl = document.getElementById("lockScreen");
    const appEl = document.getElementById("app");
    const codeInput = document.getElementById("codeInput");
    const codeBtn = document.getElementById("codeBtn");
    const codeError = document.getElementById("codeError");

    function grantAccess() {
      lockScreenEl.style.display = "none";
      appEl.style.display = "block";
      try {
        localStorage.setItem(ACCESS_KEY, "ok");
      } catch (e) {}
    }

    function showLock() {
      lockScreenEl.style.display = "flex";
      appEl.style.display = "none";
      if (codeInput) {
        setTimeout(() => codeInput.focus(), 50);
      }
    }

    function checkCodeAndEnter() {
      const val = (codeInput.value || "").trim();
      if (val === CORRECT_CODE) {
        codeError.style.display = "none";
        grantAccess();
      } else {
        codeError.style.display = "block";
      }
    }

    codeBtn.addEventListener("click", checkCodeAndEnter);
    codeInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        checkCodeAndEnter();
      }
    });

    try {
      if (localStorage.getItem(ACCESS_KEY) === "ok") {
        grantAccess();
      } else {
        showLock();
      }
    } catch (e) {
      showLock();
    }

    // =========================
    // Sauvegarde locale des erreurs
    // =========================
    const STORAGE_KEY = "bologniaErreurs_v1";
    let erreurIds = [];

    try {
      const stored = localStorage.getItem(STORAGE_KEY);
      if (stored) {
        const parsed = JSON.parse(stored);
        if (Array.isArray(parsed)) {
          erreurIds = parsed;
        }
      }
    } catch (e) {
      erreurIds = [];
    }

    function saveErreurs() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(erreurIds));
      } catch (e) {}
    }

    // =========================
    // État courant
    // =========================
    let currentCategory = "Aléatoire";
    let filteredCards = [];
    let currentIndex = 0;
    let isFront = true;

    const cardEl = document.getElementById("card");
    const infoEl = document.getElementById("info");
    const prevBtn = document.getElementById("prevBtn");
    const flipBtn = document.getElementById("flipBtn");
    const knowBtn = document.getElementById("knowBtn");
    const errorBtn = document.getElementById("errorBtn");
    const categoryButtons = document.querySelectorAll(".category-item");

    const reviewModeEl = document.getElementById("reviewMode");
    const searchModeEl = document.getElementById("searchMode");
    const searchResultsEl = document.getElementById("searchResults");
    const searchQueryLabel = document.getElementById("searchQueryLabel");
    const exitSearchBtn = document.getElementById("exitSearchBtn");
    const searchInput = document.getElementById("searchInput");
    const searchBtn = document.getElementById("searchBtn");

    function shuffleArray(arr) {
      const a = [...arr];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function buildErrorsCards() {
      return erreurIds.map(idx => allCards[idx]).filter(Boolean);
    }

    function enterSearchMode() {
      reviewModeEl.style.display = "none";
      searchModeEl.style.display = "block";
    }

    function exitSearchMode() {
      searchModeEl.style.display = "none";
      reviewModeEl.style.display = "block";
    }

    function applyCategory(categoryName) {
      currentCategory = categoryName;

      if (categoryName === "Aléatoire") {
        filteredCards = shuffleArray(allCards);
      } else if (categoryName === "Erreurs") {
        filteredCards = buildErrorsCards();
      } else {
        filteredCards = allCards.filter(card => card.category === categoryName);
      }

      currentIndex = 0;
      isFront = true;
      renderCard();
    }

    function renderCard() {
      if (!filteredCards || filteredCards.length === 0) {
        cardEl.innerHTML = "<div>Aucune carte pour cette catégorie pour l’instant.</div>";
        infoEl.textContent = "";
        prevBtn.disabled = true;
        flipBtn.disabled = true;
        knowBtn.disabled = true;
        errorBtn.disabled = true;
        errorBtn.classList.remove("active-error");
        return;
      }

      const current = filteredCards[currentIndex];
      let html = "";

      if (current.image) {
        html += `<img src="${current.image}" alt="Image de la carte">`;
      }

      html += `<div class="card-text">${isFront ? current.front : current.back}</div>`;

      if (current.caption && !isFront) {
        html += `<p class="caption">${current.caption}</p>`;
      }

      cardEl.innerHTML = html;

      infoEl.textContent =
        `Catégorie : ${currentCategory} — Carte ${currentIndex + 1} / ${filteredCards.length} — ` +
        (isFront ? "Question" : "Réponse");

      prevBtn.disabled = currentIndex === 0;
      flipBtn.disabled = false;
      knowBtn.disabled = false;
      errorBtn.disabled = false;

      const globalIndex = allCards.indexOf(current);
      const isError = globalIndex !== -1 && erreurIds.includes(globalIndex);
      errorBtn.classList.toggle("active-error", isError);
    }

    function markErrorForCurrent() {
      if (!filteredCards.length) return;
      const current = filteredCards[currentIndex];
      const idx = allCards.indexOf(current);
      if (idx === -1) return;
      if (!erreurIds.includes(idx)) {
        erreurIds.push(idx);
        saveErreurs();
      }
    }

    function unmarkErrorForCurrent() {
      if (!filteredCards.length) return;
      const current = filteredCards[currentIndex];
      const idx = allCards.indexOf(current);
      if (idx === -1) return;
      const pos = erreurIds.indexOf(idx);
      if (pos !== -1) {
        erreurIds.splice(pos, 1);
        saveErreurs();
      }
    }

    function goNextStandard() {
      if (currentIndex < filteredCards.length - 1) {
        currentIndex++;
      }
      isFront = true;
      renderCard();
    }

    // ============== Recherche ==============
    function performSearch() {
      const q = (searchInput.value || "").trim().toLowerCase();
      if (!q) return;

      const words = q.split(/\s+/).filter(Boolean);

      const results = allCards
        .map((card, index) => ({ card, index }))
        .filter(({ card }) => {
          const text = (
            (card.front || "") + " " +
            (card.back || "") + " " +
            (card.caption || "") + " " +
            (card.category || "")
          ).toLowerCase();

          return words.every(w => text.includes(w));
        });

      renderSearchResults(q, results);
      enterSearchMode();
    }

    function renderSearchResults(query, results) {
      searchQueryLabel.textContent = query;

      if (!results.length) {
        searchResultsEl.innerHTML = "<p>Aucune carte ne contient ce(s) mot(s).</p>";
        return;
      }

      let html = "";
      results.forEach(({ card, index }, i) => {
        html += `
          <article class="search-card">
            <div class="search-card-header">
              <span class="search-card-index">#${i + 1}</span>
              <span class="search-card-category">${card.category || "Sans catégorie"}</span>
            </div>
        `;
        if (card.image) {
          html += `<img src="${card.image}" alt="Image de la carte">`;
        }
        html += `
            <div class="search-card-front"><strong>Question :</strong> ${card.front || ""}</div>
            <div class="search-card-back"><strong>Réponse :</strong> ${card.back || ""}</div>
        `;
        if (card.caption) {
          html += `<div class="search-card-caption"><strong>Légende :</strong> ${card.caption}</div>`;
        }
        html += `
            <button class="search-card-jump" data-index="${index}">Réviser cette carte</button>
          </article>
        `;
      });

      searchResultsEl.innerHTML = html;
    }

    function jumpToCard(globalIndex) {
      const card = allCards[globalIndex];
      if (!card) return;

      const targetCategory = card.category || "Aléatoire";

      categoryButtons.forEach(b => {
        b.classList.toggle("active", b.dataset.category === targetCategory);
      });

      applyCategory(targetCategory);

      const idxInFiltered = filteredCards.findIndex(c => c === card);
      if (idxInFiltered !== -1) {
        currentIndex = idxInFiltered;
        isFront = true;
        renderCard();
      }

      exitSearchMode();
    }

    // =========================
    // Écouteurs d'événements
    // =========================
    cardEl.addEventListener("click", () => {
      if (!filteredCards.length) return;
      isFront = !isFront;
      renderCard();
    });

    flipBtn.addEventListener("click", () => {
      if (!filteredCards.length) return;
      isFront = !isFront;
      renderCard();
    });

    prevBtn.addEventListener("click", () => {
      if (currentIndex > 0) {
        currentIndex--;
        isFront = true;
        renderCard();
      }
    });

    // ❌ À revoir : ajoute aux erreurs + passe à la suivante
    errorBtn.addEventListener("click", () => {
      if (!filteredCards.length) return;

      if (currentCategory !== "Erreurs") {
        markErrorForCurrent();
        goNextStandard();
      } else {
        goNextStandard();
      }
    });

    // ✅ Je sais : retire des erreurs + passe à la suivante
    knowBtn.addEventListener("click", () => {
      if (!filteredCards.length) return;

      if (currentCategory === "Erreurs") {
        const previousIndex = currentIndex;
        unmarkErrorForCurrent();
        filteredCards = buildErrorsCards();

        if (filteredCards.length === 0) {
          renderCard();
          return;
        }

        if (previousIndex >= filteredCards.length) {
          currentIndex = filteredCards.length - 1;
        } else {
          currentIndex = previousIndex;
        }
        isFront = true;
        renderCard();
      } else {
        unmarkErrorForCurrent();
        goNextStandard();
      }
    });

    categoryButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        categoryButtons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        const cat = btn.dataset.category;
        exitSearchMode();
        applyCategory(cat);
      });
    });

    // Recherche : bouton + Entrée
    searchBtn.addEventListener("click", () => {
      performSearch();
    });

    searchInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        performSearch();
      }
    });

    exitSearchBtn.addEventListener("click", () => {
      exitSearchMode();
    });

    searchResultsEl.addEventListener("click", (e) => {
      const btn = e.target.closest(".search-card-jump");
      if (!btn) return;
      const idx = parseInt(btn.dataset.index, 10);
      if (!Number.isNaN(idx)) {
        jumpToCard(idx);
      }
    });

    // Initialisation
    applyCategory("Aléatoire");
  </script>
</body>
</html>



