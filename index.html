<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Flashcards Bolognia - Myriam ZERROUDI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      background: #f5f5f5;
    }

    /* Layout global : colonne gauche + zone principale */
    .layout {
      display: flex;
      min-height: 100vh;
    }

    /* Colonne de gauche */
    .sidebar {
      width: 260px;
      background: #111827;
      color: #e5e7eb;
      padding: 16px 12px;
      display: flex;
      flex-direction: column;
    }

    .sidebar h2 {
      font-size: 1rem;
      margin: 0 0 8px;
    }

    /* Liste scrollable de catégories */
    .category-list {
      margin-top: 8px;
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 6px;
      padding-right: 4px;
    }

    .category-item {
      text-align: left;
      padding: 6px 8px;
      border-radius: 8px;
      border: none;
      background: transparent;
      color: inherit;
      font-size: 0.85rem;
      cursor: pointer;
    }

    .category-item:hover {
      background: rgba(255, 255, 255, 0.12);
    }

    .category-item.active {
      background: #f9fafb;
      color: #111827;
      font-weight: 600;
    }

    /* Style spécifique pour la catégorie Erreurs (rouge clair) */
    .category-item[data-category="Erreurs"] {
      background: #fee2e2;
      color: #991b1b;
    }

    .category-item[data-category="Erreurs"]:hover {
      background: #fecaca;
    }

    .category-item[data-category="Erreurs"].active {
      background: #fecaca;
      color: #7f1d1d;
    }

    /* Zone de droite */
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
      padding: 24px;
    }

    .title {
      font-size: 1.6rem;
      font-weight: 600;
      margin: 0 0 8px;
      text-align: center;
      color: #111827;
    }

    .subtitle-name {
      font-size: 0.85rem;
      font-weight: 400;
      margin-left: 4px;
      opacity: 0.75;
    }

    /* Carte de flashcard */
    .card {
      width: 60vw;         /* plus petit qu'avant */
      max-width: 900px;
      min-height: 50vh;
      margin: 0 auto;

      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      text-align: center;
      font-size: 1rem;
      cursor: pointer;
      user-select: none;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
    }

    .card-text {
      font-size: 1.05rem;
    }

    .caption {
      margin-top: 8px;
      font-size: 0.9rem;
      color: #6b7280;
    }

    /* Image dans la carte */
    #card img {
      width: 55%;          /* plus petite que la carte */
      height: auto;
      display: block;
      margin: 0 auto 12px;
      border-radius: 12px;
    }

    /* Boutons sous la carte */
    .controls {
      margin-top: 8px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
    }

    button {
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: #111827;
      color: white;
      font-size: 0.9rem;
    }

    button:disabled {
      opacity: 0.4;
      cursor: default;
    }

    .btn-know {
      background: #16a34a; /* vert */
    }

    .btn-error {
      background: #dc2626; /* rouge */
    }

    .btn-error.active-error {
      box-shadow: 0 0 0 2px #fecaca;
    }

    .info {
      margin-top: 4px;
      font-size: 0.85rem;
      color: #6b7280;
      text-align: center;
    }

    /* Responsive simple */
    @media (max-width: 768px) {
      .layout {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        max-height: 220px;
      }

      .card {
        width: 95vw;
        min-height: 60vh;
      }

      #card img {
        width: 80%;
      }
    }
  </style>
</head>
<body>
  <div class="layout">
    <!-- Colonne de gauche : catégories -->
    <aside class="sidebar">
      <h2>Catégories</h2>
      <div class="category-list">
        <!-- Erreurs en premier -->
        <button class="category-item" data-category="Erreurs">Erreurs</button>
        <!-- Aléatoire ensuite (actif au démarrage) -->
        <button class="category-item active" data-category="Aléatoire">Aléatoire</button>
        <!-- Nouvelle catégorie Dermoscopie -->
        <button class="category-item" data-category="Dermoscopie">Dermoscopie</button>

        <button class="category-item" data-category="Prurit et dysesthésies">Prurit et dysesthésies</button>
        <button class="category-item" data-category="Affections psychocutanées">Affections psychocutanées</button>
        <button class="category-item" data-category="Psoriasis">Psoriasis</button>
        <button class="category-item" data-category="Autres affections papulosquameuses">Autres affections papulosquameuses</button>
        <button class="category-item" data-category="Erythrodermie">Erythrodermie</button>
        <button class="category-item" data-category="Lichen plan et dermatoses lichénoïdes">Lichen plan et dermatoses lichénoïdes</button>
        <button class="category-item" data-category="Dermatite atopique">Dermatite atopique</button>
        <button class="category-item" data-category="Autres éruptions eczémateuses">Autres éruptions eczémateuses</button>
        <button class="category-item" data-category="Dermatites de contact / pro / aux plantes">Dermatites de contact / pro / aux plantes</button>
        <button class="category-item" data-category="Approche clinique des dermatoses régionales">Approche clinique des dermatoses régionales</button>
        <button class="category-item" data-category="Urticaire et angio-oedème">Urticaire et angio-oedème</button>
        <button class="category-item" data-category="Erythèmes figurés">Erythèmes figurés</button>
        <button class="category-item" data-category="Erythème polymorphe, SJS et NET">Erythème polymorphe, SJS et NET</button>
        <button class="category-item" data-category="Réactions aux médicaments">Réactions aux médicaments</button>
        <button class="category-item" data-category="Purpura et affections dues à une occlusion microvasculaire">Purpura et affections dues à une occlusion microvasculaire</button>
        <button class="category-item" data-category="Vascularites">Vascularites</button>
        <button class="category-item" data-category="Dermatoses éosinophiliques">Dermatoses éosinophiliques</button>
        <button class="category-item" data-category="Dermatoses neutrophiliques">Dermatoses neutrophiliques</button>
        <button class="category-item" data-category="Dermatoses de la grossesse">Dermatoses de la grossesse</button>
        <button class="category-item" data-category="Pemphigus">Pemphigus</button>
        <button class="category-item" data-category="Pemphigoïde et épidermolyse bulleuse acquise">Pemphigoïde et épidermolyse bulleuse acquise</button>
      </div>
    </aside>

    <!-- Partie droite : titre + carte + boutons -->
    <main class="main">
      <h1 class="title">
        Flashcards Bolognia
        <span class="subtitle-name">– Myriam ZERROUDI</span>
      </h1>

      <div id="card" class="card"></div>

      <div class="controls">
        <button id="prevBtn">Précédente</button>
        <button id="flipBtn">Retourner Q/R</button>
        <button id="knowBtn" class="btn-know">Je sais ✅</button>
        <button id="errorBtn" class="btn-error">À revoir ❌</button>
      </div>

      <div id="info" class="info"></div>
    </main>
  </div>

  <script>
    // =========================
    // Données des cartes
    // =========================
    const allCards = [
      {
        category: "Urticaire et angio-oedème",
        front: "Que montre cette image ?",
        back: "Urticaire annulaire géante.",
        image: "urticaire annulaire géante p30.png",
        caption: "Photographie clinique d’urticaire annulaire géante (Bolognia p.30)."
      },
      {
        category: "Pemphigus",
        front: "Que montre cette image ?",
        back: "Pemphigoïde vulgaire",
        image: "PV p231.png",
        caption: "PV : bulles fragiles, éphémères et se rompant facilement, laissant des croûtes et érosions qui deviennent extensives."
      },
      {
        category: "Pemphigus",
        front: "Que montre cette image ?",
        back: "Pemphigoïde bulleuse",
        image: "PB.png",
        caption: "Dans la PB, de multiples bulles tendues sont observées ; le contenu des bulles est habituellement séreux comme chez ce patient. Les bulles ont une durée de vie supérieure à celles du PV, mais peuvent éventuellement se rompre, conduisant à des érosions et des croûtes."
      },
      {
        category: "Pemphigus",
        front: "Que montre cette image ?",
        back: "Pemphigus vulgaire",
        image: "PV muq.png",
        caption: "Presque tous les patients développent des érosions douloureuses de la muqueuse orale, les localisations les plus habituelles étant les muqueuses buccale et palatine, mais des lésions peuvent aussi se développer sur la gencive et la langue."
      },
      {
        category: "Pemphigus",
        front: "Que montre cette image ?",
        back: "Pemphigus vulgaire",
        image: "PV.png",
        caption: "Les vésicules et bulles flasques sont fragiles et se rompent facilement, laissant des érosions. Une réponse végétante peut occasionnellement être observée dans les lésions chroniques récalcitrantes."
      },
      {
        category: "Pemphigus",
        front: "Que montre cette image ?",
        back: "Pemphigus végétant",
        image: "pemphi v.png",
        caption: "Plaques papillomateuses étendues, végétantes, épaisses, survenant en conjonction avec des érosions. Les lésions cicatrisées montrent une hyperpigmentation post-inflammatoire résiduelle."
      },
      {
        category: "Pemphigus",
        front: "Que montre cette image ?",
        back: "Pemphigus foliacé",
        image: "PF.png",
        caption: "Plusieurs érosions survenant sur une base érythémateuse ainsi que des squames-croûtes caractéristiques, variables en épaisseur. Un site fréquent d’atteinte est le tronc. Quand la maladie progresse, les lésions deviennent confluentes ; comme les vésicules sont fragiles et se rompent facilement, seules des érosions avec squames-croûtes sont observées."
      },
      {
        category: "Pemphigus",
        front: "Que montre cette image ?",
        back: "Pemphigus érythémateux",
        image: "PE.png",
        caption: "Plaques érythémateuses avec des squames-croûtes et des érosions sur le nez et les joues. Initialement considérée comme une combinaison de pemphigus vulgaire et de lupus érythémateux, cette affection est aujourd’hui classée comme une variante localisée de pemphigus foliacé."
      },
      {
        category: "Pemphigus",
        front: "Que montre cette image ?",
        back: "Pemphigus paranéoplasique",
        image: "PP.png",
        caption: "Érosions associées à des croûtes hémorragiques, pouvant s’étendre sur la lèvre vermillon et atteindre la muqueuse nasale ; la lésion du menton ressemble à un pemphigus vulgaire."
      },
      {
        category: "Prurit et dysesthésies",
        front: "Que montre cette image ?",
        back: "Xérose et prurit chez un patient ayant une insuffisance rénale terminale en hémodialyse.",
        image: "1.png",
        caption: "Il y a des papules peu nombreuses d'une dermatose perforante acquise mélangées à des stries de grattage."
      },
      {
        category: "Prurit et dysesthésies",
        front: "Que montre cette image ?",
        back: "Dermographisme",
        image: "2.png",
        caption: "Stries d'urticaire linéaires induites par le grattage de la peau. Une recherche de dermographisme doit être effectuée chez tous les patients qui ont un prurit. "
      },
      {
        category: "Prurit et dysesthésies",
        front: "Que montre cette image ?",
        back: "Prurigo nodulaire",
        image: "3.png",
        caption: " A Papulonodules fermes, hyperpigmentés sur la face d'extension d'un avant-bras, conséquences de grattages et d'excoriations répétés. B Papulonodules et plaques à différents stades sur les genoux d'un patient qui a une dermatite atopique. "
      },
      {
        category: "Prurit et dysesthésies",
        front: "Que montre cette image ?",
        back: "Multiples lésions de prurigo nodulaire",
        image: "4.png",
        caption: " A Papulonodules fermes, hyperpigmentés sur la face d'extension d'un avant-bras, conséquences de grattages et d'excoriations répétés. B Papulonodules et plaques à différents stades sur les genoux d'un patient qui a une dermatite atopique. "
      },
      {
        category: "Prurit et dysesthésies",
        front: "Que montre cette image ?",
        back: "Lichen simplex chronique",
        image: "5.png",
        caption: "A Plaque lichénifiée de la cheville chez un homme jeune. B Noter l'accentuation des marques cutanées sur cette plaque hyperpigmentée de la partie postérieure du cou."
      },
      {
        category: "Prurit et dysesthésies",
        front: "Que montre cette image ?",
        back: "Syndrome trophique trigéminé",
        image: "6.png",
        caption: "Ulcération localisée de l'aile nasale et de la joue adjacente."
      },
      {
        category: "Prurit et dysesthésies",
        front: "Que montre cette image ?",
        back: "Syndrome douloureux régional complexe",
        image: "7.png",
        caption: " avec squames et érosions du bout des doigts"
      },
      {
        category: "Pemphigus",
        front: "Que montre cette image ?",
        back: "Pemphigus à IgA - type dermatose pustuleuse sous-cornéenne",
        image: "PIgA.png",
        caption: "Noter le respect de la partie supérieure et médiane du dos (« signe du papillon »). "
      }
    ];

    // =========================
    // Sauvegarde locale des erreurs
    // =========================
    const STORAGE_KEY = "bologniaErreurs_v1";
    let erreurIds = [];

    try {
      const stored = localStorage.getItem(STORAGE_KEY);
      if (stored) {
        const parsed = JSON.parse(stored);
        if (Array.isArray(parsed)) {
          erreurIds = parsed;
        }
      }
    } catch (e) {
      erreurIds = [];
    }

    function saveErreurs() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(erreurIds));
      } catch (e) {
        // ignore si problème de quota
      }
    }

    // =========================
    // État courant
    // =========================
    let currentCategory = "Aléatoire";
    let filteredCards = [];
    let currentIndex = 0;
    let isFront = true;

    const cardEl = document.getElementById("card");
    const infoEl = document.getElementById("info");
    const prevBtn = document.getElementById("prevBtn");
    const flipBtn = document.getElementById("flipBtn");
    const knowBtn = document.getElementById("knowBtn");
    const errorBtn = document.getElementById("errorBtn");
    const categoryButtons = document.querySelectorAll(".category-item");

    function shuffleArray(arr) {
      const a = [...arr];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function buildErrorsCards() {
      return erreurIds.map(idx => allCards[idx]).filter(Boolean);
    }

    function applyCategory(categoryName) {
      currentCategory = categoryName;

      if (categoryName === "Aléatoire") {
        filteredCards = shuffleArray(allCards);
      } else if (categoryName === "Erreurs") {
        filteredCards = buildErrorsCards();
      } else {
        filteredCards = allCards.filter(card => card.category === categoryName);
      }

      currentIndex = 0;
      isFront = true;
      renderCard();
    }

    function renderCard() {
      if (!filteredCards || filteredCards.length === 0) {
        cardEl.innerHTML = "<div>Aucune carte pour cette catégorie pour l’instant.</div>";
        infoEl.textContent = "";
        prevBtn.disabled = true;
        flipBtn.disabled = true;
        knowBtn.disabled = true;
        errorBtn.disabled = true;
        errorBtn.classList.remove("active-error");
        return;
      }

      const current = filteredCards[currentIndex];
      let html = "";

      if (current.image) {
        html += `
          <img
            src="${current.image}"
            alt="Image de la carte"
          >
        `;
      }

      html += `<div class="card-text">${isFront ? current.front : current.back}</div>`;

      if (current.caption && !isFront) {
        html += `<p class="caption">${current.caption}</p>`;
      }

      cardEl.innerHTML = html;

      infoEl.textContent =
        `Catégorie : ${currentCategory} — Carte ${currentIndex + 1} / ${filteredCards.length} — ` +
        (isFront ? "Question" : "Réponse");

      prevBtn.disabled = currentIndex === 0;
      flipBtn.disabled = false;
      knowBtn.disabled = false;
      errorBtn.disabled = false;

      // Met à jour l'état visuel du bouton "Erreurs"
      const globalIndex = allCards.indexOf(current);
      const isError = globalIndex !== -1 && erreurIds.includes(globalIndex);
      errorBtn.classList.toggle("active-error", isError);
    }

    function markErrorForCurrent() {
      if (!filteredCards.length) return;
      const current = filteredCards[currentIndex];
      const idx = allCards.indexOf(current);
      if (idx === -1) return;
      if (!erreurIds.includes(idx)) {
        erreurIds.push(idx);
        saveErreurs();
      }
    }

    function unmarkErrorForCurrent() {
      if (!filteredCards.length) return;
      const current = filteredCards[currentIndex];
      const idx = allCards.indexOf(current);
      if (idx === -1) return;
      const pos = erreurIds.indexOf(idx);
      if (pos !== -1) {
        erreurIds.splice(pos, 1);
        saveErreurs();
      }
    }

    function goNextStandard() {
      if (currentIndex < f



